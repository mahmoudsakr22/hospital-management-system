import { update } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

// تابع تحديث الحالة:
async function updatePatientStatus(newStatus) {
  if (!patientId) return;
  const patientRef = ref(db, `patients/emergency/${patientId}`);
  
  // تحديث الحقل status
  try {
    await update(patientRef, { status: newStatus });
    patientStatus.textContent = newStatus;
    alert('تم تحديث حالة المريض بنجاح');
  } catch (err) {
    console.error(err);
    alert('حدث خطأ أثناء تحديث الحالة');
  }
}

// استمع لتغيير الحالة
document.getElementById('currentStatus').addEventListener('change', (e) => {
  const val = e.target.value;
  // تحويل الحالة إلى المفاتيح التي تستخدمها صفحة الطوارئ (emergency.html)
  let statusKey = "stable"; // الافتراضي مستقر
  if (val === "حرج") statusKey = "critical";
  else if (val === "مستقر") statusKey = "stable";
  else if (val === "في تحسن") statusKey = "improving"; // لو معترف بها
  else if (val === "في تدهور") statusKey = "deteriorating";
  
  updatePatientStatus(statusKey);
});
