<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ููู ุงููุฑูุถ - ูุณุชุดูู ุงูุญูุงุฉ ุงูุฐููุฉ</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      push,
      update
    } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    import QRCode from "https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js";

    const firebaseConfig = {
      apiKey: "AIzaSyArPFi04c_vDP5Gi8bM4pem_LuvMx_eJG0",
      authDomain: "hospital-project-e4b59.firebaseapp.com",
      databaseURL: "https://hospital-project-e4b59-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hospital-project-e4b59",
      storageBucket: "hospital-project-e4b59.appspot.com",
      messagingSenderId: "974610606258",
      appId: "1:974610606258:web:71ce7d5d447bca4b4441ab"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const urlParams = new URLSearchParams(window.location.search);
    const patientId = urlParams.get("id");

    const patientRef = ref(db, "patients/emergency/" + patientId);
    const visitsRef = ref(db, "visits/" + patientId);
    const transfersRef = ref(db, "transfers/" + patientId);
    const treatmentRef = ref(db, "treatment/" + patientId);

    window.addEventListener("DOMContentLoaded", () => {
      QRCode.toCanvas(document.getElementById("qrcode"), patientId, { width: 100 });

      onValue(patientRef, (snap) => {
        const data = snap.val();
        if (!data) return;

        document.getElementById("name").textContent = data.name;
        document.getElementById("age").textContent = data.age;
        document.getElementById("nid").textContent = data.nid;
        document.getElementById("pid").textContent = patientId;
        document.getElementById("department").textContent = data.department;
        document.getElementById("doctor").textContent = data.doctor || "ุบูุฑ ูุญุฏุฏ";
        document.getElementById("timestamp").textContent = new Date(data.timestamp).toLocaleString("ar-EG");
        document.getElementById("status").textContent = data.status || "ุบูุฑ ูุญุฏุฏ";
      });

      onValue(visitsRef, (snap) => {
        const container = document.getElementById("visitRecords");
        container.innerHTML = "";
        snap.forEach((child) => {
          const visit = child.val();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="border p-2">${visit.type}</td>
            <td class="border p-2">${visit.notes}</td>
            <td class="border p-2">${new Date(visit.timestamp).toLocaleString("ar-EG")}</td>
          `;
          container.appendChild(row);
        });
      });

      onValue(transfersRef, (snap) => {
        const container = document.getElementById("transferRecords");
        container.innerHTML = "";
        snap.forEach((child) => {
          const transfer = child.val();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="border p-2">${transfer.to}</td>
            <td class="border p-2">${transfer.reason}</td>
            <td class="border p-2">${new Date(transfer.timestamp).toLocaleString("ar-EG")}</td>
          `;
          container.appendChild(row);
        });
      });

      onValue(treatmentRef, (snap) => {
        const container = document.getElementById("treatmentRecords");
        container.innerHTML = "";
        snap.forEach((child) => {
          const tr = child.val();
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="border p-2">${tr.name}</td>
            <td class="border p-2">${tr.dose}</td>
            <td class="border p-2">${new Date(tr.timestamp).toLocaleString("ar-EG")}</td>
          `;
          container.appendChild(row);
        });
      });

      document.getElementById("visitForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const type = document.getElementById("visitType").value;
        const notes = document.getElementById("visitNotes").value;

        push(visitsRef, {
          type,
          notes,
          timestamp: Date.now()
        }).then(() => {
          document.getElementById("visitForm").reset();
        });
      });

      document.getElementById("transferForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const to = document.getElementById("transferTo").value;
        const reason = document.getElementById("transferReason").value;

        push(transfersRef, {
          to,
          reason,
          timestamp: Date.now()
        });

        update(patientRef, { department: to });
      });
    });
  </script>

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-5xl mx-auto bg-white p-6 rounded shadow">

    <!-- ๐ฅ ูุนูููุงุช ุนุงูุฉ -->
    <div class="text-center mb-6">
      <img src="https://image.cdn2.seaart.me/2025-07-09/d1mo7ble878c73e3dta0-4/3d0cbb13ac1cb6a3c7d657a682e2242e_high.webp" alt="ุดุนุงุฑ ุงููุณุชุดูู" class="mx-auto mb-2">
      <h1 class="text-3xl font-bold text-blue-900">ูุณุชุดูู ุงูุญูุงุฉ ุงูุฐููุฉ</h1>
      <p class="text-gray-700 mt-2">ูุธุงู ุฅุฏุงุฑุฉ ุงููุฑุถู ุงูุฐูู - ูุชุงุจุน ุญุงูุชู ูุญุธุฉ ุจูุญุธุฉ ููุณูู ุฑุนุงูุชู ุงูุทุจูุฉ</p>
    </div>

    <h1 class="text-2xl font-bold text-center mb-4">๐ ููู ุงููุฑูุถ</h1>

    <!-- ๐น ูุนูููุงุช ุฃุณุงุณูุฉ -->
    <table class="w-full mb-6 bg-gray-50 rounded border">
      <tr><td class="p-2 font-semibold">ุงูุงุณู:</td><td id="name"></td></tr>
      <tr><td class="p-2 font-semibold">ุงูุนูุฑ:</td><td id="age"></td></tr>
      <tr><td class="p-2 font-semibold">ุงูุฑูู ุงููููู:</td><td id="nid"></td></tr>
      <tr><td class="p-2 font-semibold">ุฑูู ุงููุฑูุถ:</td><td id="pid"></td></tr>
      <tr><td class="p-2 font-semibold">ุงููุณู ุงูุญุงูู:</td><td id="department"></td></tr>
      <tr><td class="p-2 font-semibold">ุงูุทุจูุจ ุงููุนุงูุฌ:</td><td id="doctor"></td></tr>
      <tr><td class="p-2 font-semibold">ุงูุญุงูุฉ:</td><td id="status"></td></tr>
      <tr><td class="p-2 font-semibold">ุชุงุฑูุฎ ุงูุฏุฎูู:</td><td id="timestamp"></td></tr>
    </table>

    <!-- ๐ ุชุณุฌูู ุฒูุงุฑุฉ -->
    <form id="visitForm" class="mb-6 bg-gray-50 p-4 rounded">
      <h2 class="font-bold mb-2">๐ฉบ ุชุณุฌูู ุฒูุงุฑุฉ</h2>
      <select id="visitType" class="w-full p-2 mb-2 border rounded">
        <option>ูุดู ุทุจู</option>
        <option>ูุชุงุจุนุฉ</option>
        <option>ุงุณุชุดุงุฑุฉ</option>
      </select>
      <textarea id="visitNotes" class="w-full p-2 mb-2 border rounded" placeholder="ููุงุญุธุงุช ุงูุทุจูุจ..."></textarea>
      <button class="bg-green-600 text-white px-4 py-2 rounded">ุชุณุฌูู ุงูุฒูุงุฑุฉ</button>
    </form>

    <!-- ๐ ุชุญููู ููุณู ุขุฎุฑ -->
    <form id="transferForm" class="mb-6 bg-gray-50 p-4 rounded">
      <h2 class="font-bold mb-2">๐ ุชุญููู ููุณู</h2>
      <select id="transferTo" class="w-full p-2 mb-2 border rounded">
        <option value="radiology">ุงูุฃุดุนุฉ</option>
        <option value="lab">ุงููุนูู</option>
        <option value="icu">ุงูุนูุงูุฉ ุงููุฑูุฒุฉ</option>
        <option value="surgery">ุงูุนูููุงุช</option>
      </select>
      <textarea id="transferReason" class="w-full p-2 mb-2 border rounded" placeholder="ููุงุญุธุงุช ุงูุชุญููู..."></textarea>
      <button class="bg-blue-600 text-white px-4 py-2 rounded">ุชุฃููุฏ ุงูุชุญููู</button>
    </form>

    <!-- ๐งพ ุงูุณุฌูุงุช -->
    <div class="mb-6">
      <h2 class="font-bold mb-2">๐ ุณุฌู ุงูุฒูุงุฑุงุช</h2>
      <table class="w-full border">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">ุงูููุน</th>
            <th class="p-2">ุงูููุงุญุธุงุช</th>
            <th class="p-2">ุงูุชุงุฑูุฎ</th>
          </tr>
        </thead>
        <tbody id="visitRecords"></tbody>
      </table>
    </div>

    <div class="mb-6">
      <h2 class="font-bold mb-2">๐ฅ ุณุฌู ุงูุชุญูููุงุช</h2>
      <table class="w-full border">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">ุฅูู ูุณู</th>
            <th class="p-2">ุงูุณุจุจ</th>
            <th class="p-2">ุงูุชุงุฑูุฎ</th>
          </tr>
        </thead>
        <tbody id="transferRecords"></tbody>
      </table>
    </div>

    <div class="mb-6">
      <h2 class="font-bold mb-2">๐ ุณุฌู ุงูุฃุฏููุฉ ูุงูุนูุงุฌ</h2>
      <table class="w-full border">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">ุงูุฏูุงุก</th>
            <th class="p-2">ุงูุฌุฑุนุฉ</th>
            <th class="p-2">ุงูุชุงุฑูุฎ</th>
          </tr>
        </thead>
        <tbody id="treatmentRecords"></tbody>
      </table>
    </div>

    <!-- ๐ QR Code -->
    <div class="flex justify-between items-center mt-8">
      <canvas id="qrcode"></canvas>
      <a href="emergency.html" class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800">โฌ๏ธ ุฑุฌูุน ุฅูู ูุณู ุงูุทูุงุฑุฆ</a>
    </div>
    <div class="flex justify-between items-center mb-4">
  <div>
    <h1 class="text-3xl font-bold text-blue-900">๐ฉบ ูุณุชุดูู ุงูุญูุงุฉ ุงูุฐููุฉ</h1>
    <p class="text-gray-600">ูุฑุนุงูู ุจุฎุจุฑุฉ ูุงุจุชุณุงูุฉ โค๏ธ</p>
  </div>
  <button onclick="window.location.href='index.html'" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded shadow">
    ุงูุฑุฌูุน ุฅูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
  </button>
</div>

  </div>
</body>
</html>
