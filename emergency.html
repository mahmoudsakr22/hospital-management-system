<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>قسم الطوارئ - مستشفى الحياة الذكية</title>
    <meta name="description" content="نظام إدارة مرضى قسم الطوارئ في مستشفى الحياة الذكية" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f1f5f9;
            direction: rtl;
            overflow-x: hidden;
        }
        
        .emergency-header {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(220, 38, 38, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .emergency-header::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }
        
        .patient-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            height: 100%;
        }
        
        .patient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .patient-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
        }
        
        .patient-card.critical::before {
            background: var(--danger);
        }
        
        .patient-card.stable::before {
            background: var(--secondary);
        }
        
        .patient-card.improving::before {
            background: var(--warning);
        }
        
        .patient-card.deteriorating::before {
            background: #f97316;
        }
        
        .patient-card.called::before {
            background: var(--success);
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .status-badge.critical {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-badge.stable {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-badge.improving {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .status-badge.deteriorating {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }
        
        .status-badge.called {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .search-container {
            position: relative;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 1.25rem;
        }
        
        .filter-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
        }
        
        .filter-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: #64748b;
            margin-bottom: 0.5rem;
        }
        
        .filter-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.3);
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.4);
        }
        
        .patient-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .patient-info:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .patient-info i {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f1f5f9;
            border-radius: 50%;
            color: #64748b;
        }
        
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #e2e8f0;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #cbd5e1;
            margin-bottom: 1.5rem;
        }
        
        .header-container {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.3);
        }
        
        .footer-section {
            background: #0f172a;
            color: #cbd5e1;
            padding: 3rem 0;
        }
        
        .footer-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: white;
        }
        
        .footer-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #94a3b8;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
            text-decoration: none;
        }
        
        .footer-link:hover {
            color: white;
            transform: translateX(5px);
        }
        
        .social-icon {
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
            margin-right: 0.75rem;
        }
        
        .social-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }
        
        .queue-number {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .doctor-section {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.3);
        }
        
        .next-patient-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 1rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }
        
        .status-critical {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.7);
        }
        
        .status-deteriorating {
            background: #f97316;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.7);
        }
        
        .status-improving {
            background: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.7);
        }
        
        .status-stable {
            background: #10b981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.7);
        }
        
        .status-called {
            background: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
        }
        
        .call-btn {
            transition: all 0.3s ease;
        }
        
        .call-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px -5px rgba(37, 99, 235, 0.5);
        }
        
        .queue-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: bold;
            z-index: 10;
        }
        
        .queue-badge.called {
            background: rgba(34, 197, 94, 0.7);
        }
        
        .queue-badge.urgent {
            background: rgba(239, 68, 68, 0.7);
            animation: pulse 2s infinite;
        }
        
        .queue-badge.normal {
            background: rgba(16, 185, 129, 0.7);
        }
        
        .queue-badge.low {
            background: rgba(245, 158, 11, 0.7);
        }
        
        .patient-card-header {
            position: relative;
            padding-top: 3rem;
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            z-index: 50;
            max-width: 350px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid #22c55e;
        }
        
        .notification.error {
            border-left: 4px solid #ef4444;
        }
        
        .notification-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .notification-title {
            font-weight: bold;
            font-size: 1rem;
        }
        
        .notification-close {
            margin-left: auto;
            cursor: pointer;
            color: #94a3b8;
        }
        
        .notification-body {
            color: #64748b;
            font-size: 0.875rem;
        }
        
        .patient-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.5rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
        }
        
        .action-btn.view {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .action-btn.print {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .action-btn.call {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }
        
        .action-btn.history {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }
        
        .waiting-time {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 0.5rem 0;
        }
        
        .waiting-label {
            text-align: center;
            color: #94a3b8;
            font-size: 0.875rem;
        }
        
        .patient-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #f1f5f9;
        }
        
        .queue-badge.called {
            background: rgba(34, 197, 94, 0.7);
        }
        
        .queue-badge.urgent {
            background: rgba(239, 68, 68, 0.7);
            animation: pulse 2s infinite;
        }
        
        .queue-badge.normal {
            background: rgba(16, 185, 129, 0.7);
        }
        
        .queue-badge.low {
            background: rgba(245, 158, 11, 0.7);
        }
        
        .patient-list-scroll {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        
        .patient-list-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .patient-list-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        .patient-list-scroll::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
        }
        
        .priority-indicator {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            z-index: 5;
        }
        
        .priority-indicator.critical {
            background: linear-gradient(90deg, #ef4444, #b91c1c);
        }
        
        .priority-indicator.high {
            background: linear-gradient(90deg, #f97316, #c2410c);
        }
        
        .priority-indicator.medium {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        
        .priority-indicator.low {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        
        .doctor-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .doctor-action-btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 0.875rem;
        }
        
        .doctor-action-btn:hover {
            transform: translateY(-2px);
        }
        
        .doctor-action-btn.primary {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .doctor-action-btn.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="container mx-auto px-4 py-6">
        <div class="header-container flex justify-between items-center">
            <div class="flex items-center space-x-4 space-x-reverse">
                <img
                    src="https://image.cdn2.seaart.me/2025-07-09/d1mo7ble878c73e3dta0-4/3d0cbb13ac1cb6a3c7d657a682e2242e_high.webp"
                    alt="شعار المستشفى"
                    class="h-14 w-auto rounded-lg shadow-md"
                />
                <div>
                    <h1 class="text-2xl font-bold">مستشفى الحياة الذكية</h1>
                    <p class="text-sm text-blue-100">رعاية طبية متكاملة باستخدام أحدث التقنيات</p>
                </div>
            </div>
            <nav>
                <ul class="flex space-x-6 space-x-reverse">
                    <li>
                        <a href="index.html" class="text-white hover:text-blue-200 font-medium flex items-center gap-2"
                            ><i class="fas fa-home"></i> الرئيسية</a
                        >
                    </li>
                    <li>
                        <a href="#" class="hover:text-blue-200 font-medium flex items-center gap-2"
                            ><i class="fas fa-hospital"></i> الأقسام</a
                        >
                    </li>
                    <li>
                        <a href="#" class="hover:text-blue-200 font-medium flex items-center gap-2"
                            ><i class="fas fa-chart-bar"></i> الإحصائيات</a
                        >
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Doctor Section - المريض التالي -->
        <div class="doctor-section mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold flex items-center">
                        <i class="fas fa-user-md mr-3"></i>
                        للطبيب فقط
                    </h2>
                    <p class="text-white text-opacity-80 mt-1">المرضى في انتظار الفحص</p>
                </div>
                <button id="callNextPatient" class="btn btn-primary call-btn">
                    <i class="fas fa-bullhorn"></i>
                    استدعاء المريض التالي
                </button>
            </div>
            
            <div id="nextPatientCard" class="next-patient-card hidden">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold mb-1">المريض التالي في قائمة الانتظار</h3>
                        <div class="flex items-center gap-3 mt-3">
                            <span class="queue-number">
                                <i class="fas fa-hashtag"></i>
                                <span id="nextPatientNumber">1</span>
                            </span>
                            <div class="flex items-center">
                                <img src="https://picsum.photos/seed/patient1/48/48.jpg" alt="Patient Avatar" class="patient-avatar mr-3">
                                <div>
                                    <p class="text-2xl font-bold" id="nextPatientName">-</p>
                                    <p class="text-sm text-blue-200" id="nextPatientStatus">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-blue-200">الوقت في الانتظار</p>
                        <div class="waiting-time" id="waitingTime">00:00</div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <h3 class="text-lg font-bold mb-2">قائمة انتظار المرضى</h3>
                <div class="patient-list-scroll">
                    <div id="queueList" class="grid grid-cols-1 gap-2">
                        <!-- Queue list will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="mt-4 flex justify-between">
                <div class="doctor-actions">
                    <button id="markAsExamined" class="doctor-action-btn success">
                        <i class="fas fa-check-circle mr-2"></i>
                        علامة كمفحوص
                    </button>
                    <button id="resetQueue" class="doctor-action-btn primary">
                        <i class="fas fa-sync-alt mr-2"></i>
                        إعادة ترتيب الطوارئ
                    </button>
                </div>
                <div>
                    <span class="text-sm text-blue-200">عدد المرضى: <span id="patientCount" class="font-bold">0</span></span>
                </div>
            </div>
        </div>
        
        <!-- Emergency Header -->
        <div class="emergency-header mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold flex items-center">
                        <i class="fas fa-ambulance mr-3"></i>
                        قسم الطوارئ
                    </h1>
                    <p class="text-white text-opacity-90 mt-1">إدارة حالات الطوارئ بكفاءة واحترافية</p>
                </div>
                <button
                    class="btn btn-primary"
                    onclick="window.location.href='add_patient.html'"
                >
                    <i class="fas fa-plus"></i>
                    إضافة مريض جديد
                </button>
            </div>
        </div>
        
        <!-- Filters Section -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
            <div class="lg:col-span-1">
                <div class="search-container">
                    <div class="filter-label">البحث عن مريض</div>
                    <div class="relative">
                        <i class="fas fa-search search-icon"></i>
                        <input
                            id="searchInput"
                            type="text"
                            placeholder="ابحث باسم المريض أو الرقم القومي..."
                            class="search-input"
                        />
                    </div>
                </div>
            </div>
            <div>
                <div class="filter-container">
                    <div class="filter-label">التاريخ</div>
                    <input
                        id="dateFilter"
                        type="date"
                        class="filter-input"
                    />
                </div>
            </div>
            <div>
                <div class="filter-container">
                    <div class="filter-label">الحالة</div>
                    <select id="statusFilter" class="filter-input">
                        <option value="">جميع الحالات</option>
                        <option value="critical">حالات حرجة</option>
                        <option value="stable">حالات مستقرة</option>
                        <option value="improving">في تحسن</option>
                        <option value="deteriorating">في تدهور</option>
                        <option value="called">تم استدعاؤها</option>
                    </select>
                </div>
            </div>
            <div>
                <div class="filter-container">
                    <div class="filter-label">ترتيب حسب</div>
                    <select id="sortFilter" class="filter-input">
                        <option value="priority">الأولوية (حالات حرجة أولاً)</option>
                        <option value="newest">الأحدث أولاً</option>
                        <option value="oldest">الأقدم أولاً</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Patients List -->
        <div id="patientsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Patient cards will be dynamically inserted here -->
            <div class="col-span-full">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <h3 class="text-xl font-bold text-gray-700 mt-4">جاري تحميل بيانات المرضى...</h3>
                    <p class="text-gray-500">يرجى الانتظار قليلاً بينما نقوم بتحميل البيانات</p>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <!-- Footer Section -->
    <footer class="footer-section">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="footer-title">مستشفى الحياة الذكية</h3>
                    <p class="text-gray-400 mb-4">
                        نقدم رعاية طبية متكاملة باستخدام أحدث التقنيات الطبية
                        والكوادر الطبية المتخصصة.
                    </p>
                    <div class="flex space-x-3">
                        <a href="#" class="social-icon">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-icon">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="footer-title">روابط سريعة</h3>
                    <a href="#" class="footer-link">
                        <i class="fas fa-calendar-alt"></i>
                        <span>المواعيد</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-user-md"></i>
                        <span>الأطباء</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>الأسعار</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-info-circle"></i>
                        <span>عن المستشفى</span>
                    </a>
                </div>
                <div>
                    <h3 class="footer-title">اتصل بنا</h3>
                    <a href="#" class="footer-link">
                        <i class="fas fa-phone-alt"></i>
                        <span>1234</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-envelope"></i>
                        <span>info@alhayah-smart.com</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>شارع الطبيعة، الرياض</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-clock"></i>
                        <span>24 ساعة طوال أيام الأسبوع</span>
                    </a>
                </div>
                <div>
                    <h3 class="footer-title">خدماتنا</h3>
                    <a href="#" class="footer-link">
                        <i class="fas fa-procedures"></i>
                        <span>الطوارئ</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-stethoscope"></i>
                        <span>العيادات الخارجية</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-x-ray"></i>
                        <span>الأشعة والتصوير</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-flask"></i>
                        <span>المختبرات الطبية</span>
                    </a>
                </div>
            </div>
            <div class="border-t border-gray-700 pt-6 text-center">
                <p class="text-gray-400">© 2025 مستشفى الحياة الذكية. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, onValue, update, set } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyArPFi04c_vDP5Gi8bM4pem_LuvMx_eJG0",
            authDomain: "hospital-project-e4b59.firebaseapp.com",
            databaseURL: "https://hospital-project-e4b59-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "hospital-project-e4b59",
            storageBucket: "hospital-project-e4b59.appspot.com",
            messagingSenderId: "974610606258",
            appId: "1:974610606258:web:71ce7d5d447bca4b4441ab",
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let allPatients = {};
        let currentQueue = [];
        let nextPatientCard = document.getElementById("nextPatientCard");
        let queueList = document.getElementById("queueList");
        let callNextPatientBtn = document.getElementById("callNextPatient");
        let markAsExaminedBtn = document.getElementById("markAsExamined");
        let resetQueueBtn = document.getElementById("resetQueue");
        let patientCountElement = document.getElementById("patientCount");
        
        window.addEventListener("DOMContentLoaded", () => {
            const emergencyRef = ref(db, "patients/emergency");
            const container = document.getElementById("patientsList");
            const searchInput = document.getElementById("searchInput");
            const dateFilter = document.getElementById("dateFilter");
            const statusFilter = document.getElementById("statusFilter");
            const sortFilter = document.getElementById("sortFilter");
            
            onValue(emergencyRef, (snapshot) => {
                container.innerHTML = "";
                
                if (snapshot.exists()) {
                    allPatients = snapshot.val();
                    renderPatients(allPatients);
                    updateNextPatientDisplay();
                    updateQueueList();
                } else {
                    container.innerHTML = `
                        <div class="col-span-full">
                            <div class="empty-state">
                                <i class="fas fa-user-injured text-5xl"></i>
                                <h3 class="text-xl font-bold text-gray-700 mb-2">لا يوجد مرضى حالياً</h3>
                                <p class="text-gray-500">لا توجد حالات مسجلة في قسم الطوارئ في الوقت الحالي.</p>
                            </div>
                        </div>
                    `;
                }
            });
            
            // Event listeners for filters
            searchInput.addEventListener("input", () => {
                applyFilters();
            });
            
            dateFilter.addEventListener("change", () => {
                applyFilters();
            });
            
            statusFilter.addEventListener("change", () => {
                applyFilters();
            });
            
            sortFilter.addEventListener("change", () => {
                applyFilters();
            });
            
            // Call next patient button
            callNextPatientBtn.addEventListener("click", () => {
                callNextPatient();
            });
            
            // Mark as examined button
            markAsExaminedBtn.addEventListener("click", () => {
                markPatientAsExamined();
            });
            
            // Reset queue button
            resetQueueBtn.addEventListener("click", () => {
                resetQueue();
            });
        });
        
        function applyFilters() {
            const term = searchInput.value.toLowerCase();
            const selectedDate = dateFilter.value;
            const selectedStatus = statusFilter.value;
            const sortOption = sortFilter.value;
            
            let filtered = Object.entries(allPatients).filter(([id, patient]) => {
                const matchSearch = 
                    patient.name.toLowerCase().includes(term) ||
                    id.toLowerCase().includes(term) ||
                    patient.nid.toLowerCase().includes(term);
                    
                const matchDate = selectedDate
                    ? new Date(patient.timestamp).toISOString().split("T")[0] === selectedDate
                    : true;
                    
                const matchStatus = selectedStatus
                    ? patient.status === selectedStatus
                    : true;
                    
                return matchSearch && matchDate && matchStatus;
            });
            
            // Sort the results
            if (sortOption === 'priority') {
                filtered = filtered.sort(([, a], [, b]) => {
                    const priorityOrder = { critical: 0, deteriorating: 1, improving: 2, stable: 3, called: 4 };
                    return priorityOrder[a.status] - priorityOrder[b.status];
                });
            } else if (sortOption === 'newest') {
                filtered = filtered.sort(([, a], [, b]) => b.timestamp - a.timestamp);
            } else if (sortOption === 'oldest') {
                filtered = filtered.sort(([, a], [, b]) => a.timestamp - b.timestamp);
            }
            
            renderPatients(Object.fromEntries(filtered));
        }
        
        function renderPatients(data) {
            container.innerHTML = "";
            
            if (Object.keys(data).length === 0) {
                container.innerHTML = `
                    <div class="col-span-full">
                        <div class="empty-state">
                            <i class="fas fa-search text-5xl"></i>
                            <h3 class="text-xl font-bold text-gray-700 mb-2">لا توجد نتائج مطابقة</h3>
                            <p class="text-gray-500">لم نتمكن من العثور على مرضى يطابقون معايير البحث.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            Object.entries(data).forEach(([id, patient]) => {
                const card = document.createElement("div");
                card.className = `patient-card ${patient.status}`;
                
                const statusText = {
                    critical: "حالة حرجة",
                    stable: "حالة مستقرة",
                    improving: "في تحسن",
                    deteriorating: "في تدهور",
                    called: "تم استدعاؤها"
                };
                
                const statusIcon = {
                    critical: "fa-heartbeat",
                    stable: "fa-check-circle",
                    improving: "fa-arrow-trend-up",
                    deteriorating: "fa-arrow-trend-down",
                    called: "fa-phone"
                };
                
                const priorityClass = {
                    critical: "critical",
                    deteriorating: "high",
                    improving: "medium",
                    stable: "low",
                    called: "low"
                };
                
                card.innerHTML = `
                    <div class="priority-indicator ${priorityClass[patient.status]}"></div>
                    <div class="queue-badge ${patient.status === 'called' ? 'called' : patient.status === 'critical' ? 'urgent' : 'normal'}">
                        <i class="fas fa-hashtag"></i>
                        <span>${patient.queueNumber}</span>
                    </div>
                    <div class="patient-card-header">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">${patient.name}</h2>
                                <p class="text-sm text-gray-500">الرقم القومي: ${patient.nid}</p>
                            </div>
                            <span class="status-badge ${patient.status}">
                                <i class="fas ${statusIcon[patient.status]}"></i>
                                ${statusText[patient.status]}
                            </span>
                        </div>
                        
                        <div class="space-y-3 text-gray-600 mb-4">
                            <div class="patient-info">
                                <i class="fas fa-birthday-cake"></i>
                                <span>العمر: ${patient.age} سنة</span>
                            </div>
                            <div class="patient-info">
                                <i class="fas fa-calendar-day"></i>
                                <span>تاريخ التسجيل: ${new Date(patient.timestamp).toLocaleDateString("ar-EG")}</span>
                            </div>
                            <div class="patient-info">
                                <i class="fas fa-clock"></i>
                                <span>الوقت: ${new Date(patient.timestamp).toLocaleTimeString("ar-EG")}</span>
                            </div>
                        </div>
                        
                        <div class="patient-actions mt-4">
                            <button onclick="viewPatient('${id}')" class="action-btn view">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="printCard('${id}')" class="action-btn print">
                                <i class="fas fa-print"></i>
                            </button>
                            <button onclick="callPatient('${id}')" class="action-btn call">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button onclick="viewHistory('${id}')" class="action-btn history">
                                <i class="fas fa-history"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function updateNextPatientDisplay() {
            if (currentQueue.length === 0) {
                nextPatientCard.classList.add("hidden");
                return;
            }
            
            const nextPatient = currentQueue[0];
            
            // Update the next patient display
            document.getElementById("nextPatientName").textContent = nextPatient.name;
            document.getElementById("nextPatientNumber").textContent = nextPatient.queueNumber;
            document.getElementById("nextPatientStatus").textContent = {
                critical: "حالة حرجة",
                stable: "حالة مستقرة",
                improving: "في تحسن",
                deteriorating: "في تدهور",
                called: "تم استدعاؤها"
            }[nextPatient.status];
            
            // Calculate waiting time
            const waitingTime = Math.floor((Date.now() - nextPatient.timestamp) / (1000 * 60));
            const hours = Math.floor(waitingTime / 60);
            const minutes = waitingTime % 60;
            document.getElementById("waitingTime").textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
            
            // Show the next patient card
            nextPatientCard.classList.remove("hidden");
        }
        
        function updateQueueList() {
            queueList.innerHTML = "";
            
            if (currentQueue.length === 0) {
                queueList.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <i class="fas fa-hourglass-half text-2xl mb-2"></i>
                        <p>لا توجد مرضى في قائمة الانتظار</p>
                    </div>
                `;
                return;
            }
            
            currentQueue.forEach((patient, index) => {
                const queueItem = document.createElement("div");
                queueItem.className = `flex items-center justify-between p-3 rounded-lg ${index === 0 ? 'bg-blue-50 border border-blue-200' : 'bg-gray-50'}`;
                
                const statusText = {
                    critical: "حالة حرجة",
                    stable: "حالة مستقرة",
                    improving: "في تحسن",
                    deteriorating: "في تدهور",
                    called: "تم استدعاؤها"
                };
                
                queueItem.innerHTML = `
                    <div class="flex items-center">
                        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full ${index === 0 ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'} font-bold mr-3">
                            ${index + 1}
                        </span>
                        <div>
                            <p class="font-medium">${patient.name}</p>
                            <p class="text-sm text-gray-500">${patient.age} سنة - ${statusText[patient.status]}</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-sm text-gray-500 mr-2">الوقت:</span>
                        <span class="text-sm font-medium">${Math.floor((Date.now() - patient.timestamp) / (1000 * 60))} دقيقة</span>
                    </div>
                `;
                
                queueList.appendChild(queueItem);
            });
            
            // Update patient count
            patientCountElement.textContent = currentQueue.length;
        }
        
        function callNextPatient() {
            if (currentQueue.length === 0) {
                showNotification("لا توجد مرضى في قائمة الانتظار", "error");
                return;
            }
            
            const nextPatient = currentQueue[0];
            
            // Update the patient status to "called"
            update(ref(db, `patients/emergency/${nextPatient.id}`), {
                status: "called",
                callTime: Date.now()
            }).then(() => {
                // Show notification
                showNotification(`تم استدعاء المريض: ${nextPatient.name}`, "success");
                
                // Remove the patient from the queue
                currentQueue.shift();
                
                // Update the queue numbers for remaining patients
                updateQueueNumbers();
                
                // Update the UI
                updateNextPatientDisplay();
                updateQueueList();
            }).catch((error) => {
                showNotification(`خطأ في استدعاء المريض: ${error.message}`, "error");
            });
        }
        
        function markPatientAsExamined() {
            if (currentQueue.length === 0) {
                showNotification("لا توجد مرضى في قائمة الانتظار", "error");
                return;
            }
            
            const nextPatient = currentQueue[0];
            
            // Remove the patient from the database
            set(ref(db, `patients/emergency/${nextPatient.id}`), null).then(() => {
                // Show notification
                showNotification(`تم فحص المريض: ${nextPatient.name}`, "success");
                
                // Remove the patient from the queue
                currentQueue.shift();
                
                // Update the queue numbers for remaining patients
                updateQueueNumbers();
                
                // Update the UI
                updateNextPatientDisplay();
                updateQueueList();
            }).catch((error) => {
                showNotification(`خطأ في فحص المريض: ${error.message}`, "error");
            });
        }
        
        function resetQueue() {
            if (Object.keys(allPatients).length === 0) {
                showNotification("لا توجد مرضى لاعادة ترتيبهم", "error");
                return;
            }
            
            // Sort patients by priority
            const sortedPatients = Object.entries(allPatients).sort(([, a], [, b]) => {
                const priorityOrder = { critical: 0, deteriorating: 1, improving: 2, stable: 3 };
                return priorityOrder[a.status] - priorityOrder[b.status];
            });
            
            // Update queue numbers
            const updates = {};
            sortedPatients.forEach(([id, patient], index) => {
                updates[`patients/emergency/${id}/queueNumber`] = index + 1;
            });
            
            // Apply updates
            update(ref(db), updates).then(() => {
                showNotification("تم اعادة ترتيب قائمة الانتظار بنجاح", "success");
            }).catch((error) => {
                showNotification(`خطأ في اعادة ترتيب القائمة: ${error.message}`, "error");
            });
        }
        
        function updateQueueNumbers() {
            if (currentQueue.length === 0) return;
            
            const updates = {};
            currentQueue.forEach((patient, index) => {
                updates[`patients/emergency/${patient.id}/queueNumber`] = index + 1;
            });
            
            update(ref(db), updates);
        }
        
        window.viewPatient = function (id) {
            window.location.href = `patient.html?id=${id}`;
        };
        
        window.printCard = function (id) {
            showNotification("ميزة الطباعة سيتم تنفيذها قريباً للبطاقة ID: " + id, "success");
        };
        
        window.callPatient = function (id) {
            // Find the patient in the queue
            const patientIndex = currentQueue.findIndex(p => p.id === id);
            if (patientIndex !== -1) {
                // Move the patient to the front of the queue
                const patient = currentQueue[patientIndex];
                currentQueue.splice(patientIndex, 1);
                currentQueue.unshift(patient);
                
                // Update the database
                updateQueueNumbers();
                
                // Show notification
                showNotification(`تم استدعاء المريض: ${patient.name}`, "success");
            }
        };
        
        window.viewHistory = function (id) {
            showNotification(`سيتم عرض سجل المريض ID: ${id} قريباً`, "success");
        };
        
        // Global notification function
        function showNotification(message, type = "success") {
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="notification-title">
                        <i class="fas ${type === "success" ? "fa-check-circle text-green-500" : "fa-exclamation-circle text-red-500"} mr-2"></i>
                        ${type === "success" ? "نجاح" : "خطأ"}
                    </div>
                    <div class="notification-close">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
                <div class="notification-body">
                    ${message}
                </div>
            `;
            
            document.getElementById("notificationContainer").appendChild(notification);
            
            // Show notification with animation
            setTimeout(() => {
                notification.classList.add("show");
            }, 100);
            
            // Close notification on click
            notification.querySelector(".notification-close").addEventListener("click", () => {
                notification.classList.remove("show");
                setTimeout(() => {
                    notification.remove();
                }, 300);
            });
            
            // Auto close after 5 seconds
            setTimeout(() => {
                notification.classList.remove("show");
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }
    </script>
</body>
</html>
