<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قسم الطوارئ - مستشفى الحياة الذكية</title>
    <meta name="description" content="نظام إدارة مرضى قسم الطوارئ في مستشفى الحياة الذكية">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        body {
            font-family: 'Tajawal', sans-serif;
        }
        .patient-card {
            transition: all 0.3s ease;
        }
        .patient-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header Section -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4 space-x-reverse">
                <img src="https://picsum.photos/50?random=1" alt="شعار المستشفى" class="h-12">
                <h1 class="text-xl font-bold text-gray-800">مستشفى الحياة الذكية</h1>
            </div>
            <nav>
                <ul class="flex space-x-6 space-x-reverse">
                    <li><a href="#" class="text-blue-600 hover:text-blue-800">الرئيسية</a></li>
                    <li><a href="#" class="hover:text-blue-600">الأقسام</a></li>
                    <li><a href="#" class="hover:text-blue-600">الإحصائيات</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-red-600">
                <i class="fas fa-ambulance ml-2"></i>
                قسم الطوارئ
            </h1>
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                <i class="fas fa-plus ml-2"></i>
                إضافة مريض جديد
            </button>
        </div>

        <!-- Filters Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="relative">
                    <input id="searchInput" type="text" placeholder="ابحث باسم المريض أو الرقم القومي..." 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg pr-10">
                    <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                </div>
                <div>
                    <input id="dateFilter" type="date" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="">جميع الحالات</option>
                        <option value="critical">حالات حرجة</option>
                        <option value="stable">حالات مستقرة</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Patients List -->
        <div id="patientsList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Patient cards will be dynamically inserted here -->
            <div class="text-center py-8 text-gray-500">
                <i class="fas fa-spinner fa-spin fa-2x mb-2"></i>
                <p>جاري تحميل بيانات المرضى...</p>
            </div>
        </div>
    </main>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">مستشفى الحياة الذكية</h3>
                    <p class="text-gray-300">نقدم رعاية طبية متكاملة باستخدام أحدث التقنيات الطبية.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">روابط سريعة</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-300 hover:text-white">المواعيد</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">الأطباء</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-white">الأسعار</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">اتصل بنا</h3>
                    <p class="text-gray-300"><i class="fas fa-phone ml-2"></i> 0123456789</p>
                    <p class="text-gray-300"><i class="fas fa-envelope ml-2"></i> info@smartlifehospital.com</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">تابعنا</h3>
                    <div class="flex space-x-4 space-x-reverse">
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-300 hover:text-white"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>© 2023 مستشفى الحياة الذكية. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyArPFi04c_vDP5Gi8bM4pem_LuvMx_eJG0",
            authDomain: "hospital-project-e4b59.firebaseapp.com",
            databaseURL: "https://hospital-project-e4b59-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "hospital-project-e4b59",
            storageBucket: "hospital-project-e4b59.appspot.com",
            messagingSenderId: "974610606258",
            appId: "1:974610606258:web:71ce7d5d447bca4b4441ab"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let allPatients = {};

        window.addEventListener("DOMContentLoaded", () => {
            const emergencyRef = ref(db, "patients/emergency");
            const container = document.getElementById("patientsList");
            const searchInput = document.getElementById("searchInput");
            const dateFilter = document.getElementById("dateFilter");

            onValue(emergencyRef, (snapshot) => {
                container.innerHTML = "";
                if (snapshot.exists()) {
                    allPatients = snapshot.val();
                    renderPatients(allPatients);
                } else {
                    container.innerHTML = `
                        <div class="col-span-2 bg-white p-8 rounded-lg shadow text-center">
                            <i class="fas fa-user-injured text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-600 mb-2">لا يوجد مرضى حالياً</h3>
                            <p class="text-gray-500">لا توجد حالات مسجلة في قسم الطوارئ في الوقت الحالي.</p>
                        </div>
                    `;
                }
            });

            searchInput.addEventListener("input", () => {
                applyFilters();
            });

            dateFilter.addEventListener("change", () => {
                applyFilters();
            });

            function applyFilters() {
                const term = searchInput.value.toLowerCase();
                const selectedDate = dateFilter.value;
                const filtered = Object.fromEntries(
                    Object.entries(allPatients).filter(([id, patient]) => {
                        const matchSearch = 
                            patient.name.toLowerCase().includes(term) ||
                            id.toLowerCase().includes(term) ||
                            patient.nid.toLowerCase().includes(term);

                        const matchDate = selectedDate
                            ? new Date(patient.timestamp).toISOString().split("T")[0] === selectedDate
                            : true;

                        return matchSearch && matchDate;
                    })
                );
                renderPatients(filtered);
            }

            function renderPatients(data) {
                container.innerHTML = "";
                if (Object.keys(data).length === 0) {
                    container.innerHTML = `
                        <div class="col-span-2 bg-white p-8 rounded-lg shadow text-center">
                            <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-600 mb-2">لا توجد نتائج مطابقة</h3>
                            <p class="text-gray-500">لم نتمكن من العثور على مرضى يطابقون معايير البحث.</p>
                        </div>
                    `;
                    return;
                }
                
                Object.entries(data).forEach(([id, patient]) => {
                    const card = document.createElement("div");
                    card.className = "patient-card bg-white shadow-md rounded-lg overflow-hidden border-l-4 border-red-500";
                    card.innerHTML = `
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h2 class="text-xl font-bold text-gray-800">${patient.name}</h2>
                                <span class="px-2 py-1 text-xs rounded-full ${patient.status === 'critical' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                    ${patient.status === 'critical' ? 'حالة حرجة' : 'حالة مستقرة'}
                                </span>
                            </div>
                            <div class="space-y-2 text-gray-600">
                                <p><i class="fas fa-id-card ml-2"></i> <strong>الرقم القومي:</strong> ${patient.nid}</p>
                                <p><i class="fas fa-birthday-cake ml-2"></i> <strong>العمر:</strong> ${patient.age}</p>
                                <p><i class="fas fa-calendar-day ml-2"></i> <strong>تاريخ التسجيل:</strong> ${new Date(patient.timestamp).toLocaleDateString("ar-EG")}</p>
                                <p><i class="fas fa-clock ml-2"></i> <strong>الوقت:</strong> ${new Date(patient.timestamp).toLocaleTimeString("ar-EG")}</p>
                            </div>
                            <div class="mt-4 flex justify-end space-x-3 space-x-reverse">
                                <button onclick="viewPatient('${id}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                    <i class="fas fa-eye ml-2"></i> عرض التفاصيل
                                </button>
                                <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
                                    <i class="fas fa-print ml-2"></i> طباعة
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        });

        window.viewPatient = function(id) {
            window.location.href = `patient.html?id=${id}`;
        };
    </script>
</body>
</html>
