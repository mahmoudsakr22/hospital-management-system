<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نظام إدارة المستشفى المتقدم - مستشفى الحياة الذكية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0066CC;
      --primary-hover: #004499;
      --secondary-color: #00A8E8;
      --accent-color: #00C9A7;
      --danger-color: #FF6B6B;
      --warning-color: #FFD93D;
      --success-color: #6BCF7F;
      --dark-color: #2C3E50;
      --light-bg: #F0F8FF;
      --card-bg: #FFFFFF;
      --text-primary: #2C3E50;
      --text-secondary: #6C757D;
      --border-color: #E1E8ED;
      --shadow-sm: 0 2px 4px rgba(0, 102, 204, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 102, 204, 0.12);
      --shadow-lg: 0 8px 24px rgba(0, 102, 204, 0.16);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Cairo', sans-serif; 
      background: linear-gradient(135deg, #F0F8FF 0%, #E6F4F9 100%);
      min-height: 100vh;
      color: var(--text-primary);
    }
    
    /* Login Styles */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    
    .login-card {
      background: white;
      border-radius: 20px;
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      width: 100%;
      max-width: 450px;
    }
    
    .login-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      padding: 30px;
      text-align: center;
      color: white;
    }
    
    .login-body {
      padding: 30px;
    }
    
    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      width: 260px;
      background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      z-index: 1000;
      transform: translateX(0);
      transition: transform 0.3s ease;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }
    
    .sidebar.collapsed {
      transform: translateX(100%);
    }
    
    .sidebar-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: white;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
    }
    
    .sidebar-menu {
      padding: 20px 0;
    }
    
    .sidebar-item {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .sidebar-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-item.active {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .sidebar-item.active::before {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: white;
    }
    
    .sidebar-item i {
      margin-left: 15px;
      font-size: 18px;
    }
    
    .sidebar-text {
      font-size: 16px;
      font-weight: 500;
    }
    
    .sidebar-submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-submenu.open {
      max-height: 500px;
    }
    
    .sidebar-submenu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px 12px 50px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .sidebar-submenu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    /* Main Content Styles */
    .main-content {
      margin-right: 260px;
      transition: margin-right 0.3s ease;
      min-height: 100vh;
    }
    
    .main-content.expanded {
      margin-right: 0;
    }
    
    /* Header Styles */
    .medical-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    
    .medical-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,133.3C960,128,1056,96,1152,90.7C1248,85,1344,107,1392,117.3L1440,128L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat;
      background-size: cover;
      opacity: 0.3;
    }
    
    .header-content {
      position: relative;
      z-index: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
    }
    
    .menu-toggle {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .menu-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .notification-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .notification-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
    }
    
    .user-dropdown {
      position: relative;
    }
    
    .user-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .user-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-weight: bold;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      min-width: 200px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    
    .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      color: var(--text-primary);
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      background: var(--light-bg);
    }
    
    .dropdown-divider {
      height: 1px;
      background: var(--border-color);
      margin: 5px 0;
    }
    
    /* Page Content Styles */
    .page-content {
      padding: 20px;
    }
    
    .page-header {
      margin-bottom: 20px;
    }
    
    .page-title {
      font-size: 24px;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 5px;
    }
    
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .breadcrumb-item:not(:last-child)::after {
      content: '/';
      margin-right: 5px;
    }
    
    /* Card Styles */
    .medical-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }
    
    .medical-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .medical-card:hover::before {
      opacity: 1;
    }
    
    .medical-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    
    .card-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-title i {
      color: var(--primary-color);
    }
    
    .card-body {
      padding: 20px;
    }
    
    /* Stat Cards */
    .stat-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,102,204,0.05) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .stat-card:hover::after {
      opacity: 1;
    }
    
    .stat-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 16px;
    }
    
    /* Buttons */
    .btn-medical {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-medical:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      background: linear-gradient(135deg, var(--primary-hover), var(--secondary-color));
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-sm {
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
    }
    
    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%230066CC'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left 12px center;
      background-size: 20px;
      padding-left: 40px;
    }
    
    /* Table Styles */
    .medical-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .medical-table th {
      background: var(--light-bg);
      padding: 12px 15px;
      text-align: right;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 2px solid var(--border-color);
    }
    
    .medical-table td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .medical-table tr:hover {
      background: rgba(0, 102, 204, 0.05);
    }
    
    /* Tab Styles */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tab-nav {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 20px;
    }
    
    .tab-btn {
      background: none;
      border: none;
      padding: 12px 20px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
      color: var(--primary-color);
    }
    
    .tab-btn.active {
      color: var(--primary-color);
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      right: 0;
      left: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal.show .modal-content {
      transform: scale(1);
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      color: var(--text-secondary);
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .modal-close:hover {
      background: var(--light-bg);
      color: var(--danger-color);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Chart Container */
    .chart-wrapper {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chart-title i {
      color: var(--primary-color);
    }
    
    /* Department Badge */
    .dept-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .dept-emergency {
      background: rgba(255, 107, 107, 0.1);
      color: var(--danger-color);
    }
    
    .dept-icu {
      background: rgba(139, 92, 246, 0.1);
      color: #8B5CF6;
    }
    
    .dept-surgery {
      background: rgba(0, 102, 204, 0.1);
      color: var(--primary-color);
    }
    
    .dept-radiology {
      background: rgba(14, 165, 233, 0.1);
      color: #0EA5E9;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(100%);
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .main-content {
        margin-right: 0;
      }
    }
    
    @media (max-width: 768px) {
      .stat-card {
        margin-bottom: 16px;
      }
      
      .header-content {
        padding: 15px;
      }
      
      .page-content {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div class="sidebar-logo">
          <img src="https://t90121098672.p.clickup-attachments.com/t90121098672/aab7a4bd-0c9c-438c-8bfa-b5b1ec339843/generated-image-05102b72-8a2a-485a-9362-1371947b2a5a.png?view=open" 
               class="w-14 h-14 rounded-full" alt="شعار المستشفى">
        </div>
        <h2 class="text-2xl font-bold">مستشفى الحياة الذكية</h2>
        <p class="text-sm opacity-90 mt-2">نظام إدارة المستشفى المتقدم</p>
      </div>
      <div class="login-body">
        <form id="loginForm">
          <div class="form-group">
            <label class="form-label">اسم المستخدم</label>
            <div class="relative">
              <span class="absolute right-3 top-3 text-gray-400">
                <i class="fas fa-user"></i>
              </span>
              <input type="text" id="username" class="form-input pr-10" placeholder="أدخل اسم المستخدم" required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">كلمة المرور</label>
            <div class="relative">
              <span class="absolute right-3 top-3 text-gray-400">
                <i class="fas fa-lock"></i>
              </span>
              <input type="password" id="password" class="form-input pr-10" placeholder="أدخل كلمة المرور" required>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">نوع المستخدم</label>
            <select id="userType" class="form-input form-select" required>
              <option value="">-- اختر نوع المستخدم --</option>
              <option value="admin">مدير النظام</option>
              <option value="doctor">طبيب</option>
              <option value="nurse">ممرض</option>
              <option value="reception">موظف استقبال</option>
              <option value="lab">فني مختبر</option>
              <option value="pharmacy">صيدلي</option>
            </select>
          </div>
          <button type="submit" class="btn-medical w-full">
            <i class="fas fa-sign-in-alt"></i>
            تسجيل الدخول
          </button>
          <div class="text-center mt-4">
            <a href="#" class="text-sm text-blue-600 hover:underline">هل نسيت كلمة المرور؟</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Main Application -->
  <div id="mainApp" class="hidden">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="https://t90121098672.p.clickup-attachments.com/t90121098672/aab7a4bd-0c9c-438c-8bfa-b5b1ec339843/generated-image-05102b72-8a2a-485a-9362-1371947b2a5a.png?view=open" 
               class="w-14 h-14 rounded-full" alt="شعار المستشفى">
        </div>
        <h3 class="text-white font-bold">مستشفى الحياة الذكية</h3>
        <p class="text-white text-xs opacity-80">نظام إدارة المستشفى</p>
      </div>
      <nav class="sidebar-menu">
        <a href="#" class="sidebar-item active" data-page="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span class="sidebar-text">لوحة التحكم</span>
        </a>
        
        <div class="sidebar-item" id="patientsMenu">
          <i class="fas fa-users"></i>
          <span class="sidebar-text">إدارة المرضى</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="patientsSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="patients-registration">تسجيل مريض جديد</a>
          <a href="#" class="sidebar-submenu-item" data-page="patients-list">قائمة المرضى</a>
          <a href="#" class="sidebar-submenu-item" data-page="patients-search">بحث متقدم</a>
        </div>
        
        <div class="sidebar-item" id="appointmentsMenu">
          <i class="fas fa-calendar-check"></i>
          <span class="sidebar-text">المواعيد</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="appointmentsSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="appointments-schedule">جدولة المواعيد</a>
          <a href="#" class="sidebar-submenu-item" data-page="appointments-list">قائمة المواعيد</a>
          <a href="#" class="sidebar-submenu-item" data-page="appointments-calendar">التقويم</a>
        </div>
        
        <div class="sidebar-item" id="medicalMenu">
          <i class="fas fa-notes-medical"></i>
          <span class="sidebar-text">السجلات الطبية</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="medicalSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="medical-records">السجلات الطبية</a>
          <a href="#" class="sidebar-submenu-item" data-page="prescriptions">الوصفات الطبية</a>
          <a href="#" class="sidebar-submenu-item" data-page="lab-results">نتائج المختبر</a>
          <a href="#" class="sidebar-submenu-item" data-page="radiology">الأشعة</a>
        </div>
        
        <div class="sidebar-item" id="hospitalMenu">
          <i class="fas fa-hospital"></i>
          <span class="sidebar-text">إدارة المستشفى</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="hospitalSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="rooms">الغرف والأسرّة</a>
          <a href="#" class="sidebar-submenu-item" data-page="departments">الأقسام</a>
          <a href="#" class="sidebar-submenu-item" data-page="staff">الموظفين</a>
          <a href="#" class="sidebar-submenu-item" data-page="doctors">الأطباء</a>
        </div>
        
        <div class="sidebar-item" id="pharmacyMenu">
          <i class="fas fa-pills"></i>
          <span class="sidebar-text">الصيدلية</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="pharmacySubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="pharmacy-inventory">المخزون</a>
          <a href="#" class="sidebar-submenu-item" data-page="pharmacy-prescriptions">الوصفات</a>
        </div>
        
        <div class="sidebar-item" id="billingMenu">
          <i class="fas fa-file-invoice-dollar"></i>
          <span class="sidebar-text">الفواتير والتأمين</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="billingSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="billing-invoices">الفواتير</a>
          <a href="#" class="sidebar-submenu-item" data-page="billing-insurance">التأمين الصحي</a>
          <a href="#" class="sidebar-submenu-item" data-page="billing-payments">المدفوعات</a>
        </div>
        
        <a href="#" class="sidebar-item" data-page="reports">
          <i class="fas fa-chart-bar"></i>
          <span class="sidebar-text">التقارير</span>
        </a>
        
        <a href="#" class="sidebar-item" data-page="settings">
          <i class="fas fa-cog"></i>
          <span class="sidebar-text">الإعدادات</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">
      <!-- Header -->
      <header class="medical-header">
        <div class="header-content">
          <button id="menuToggle" class="menu-toggle">
            <i class="fas fa-bars"></i>
          </button>
          
          <div class="header-actions">
            <button class="notification-btn">
              <i class="fas fa-bell"></i>
              <span class="notification-badge">3</span>
            </button>
            
            <div class="user-dropdown">
              <button id="userBtn" class="user-btn">
                <div class="user-avatar">أ</div>
                <span id="userName">أحمد محمد</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div id="userDropdown" class="dropdown-menu">
                <a href="#" class="dropdown-item">
                  <i class="fas fa-user"></i>
                  <span>الملف الشخصي</span>
                </a>
                <a href="#" class="dropdown-item">
                  <i class="fas fa-cog"></i>
                  <span>الإعدادات</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" id="logoutBtn" class="dropdown-item">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>تسجيل الخروج</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div id="pageContent" class="page-content">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page active">
          <div class="page-header">
            <h1 class="page-title">لوحة التحكم</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">لوحة التحكم</span>
            </div>
          </div>
          
          <!-- Statistics Dashboard -->
          <section class="mb-8 fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(0, 102, 204, 0.1); color: var(--primary-color);">
                  <i class="fas fa-users"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">إجمالي المرضى</h3>
                <div id="totalPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-arrow-up text-green-500"></i> هذا الشهر
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(107, 207, 127, 0.1); color: var(--success-color);">
                  <i class="fas fa-user-plus"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">المسجلين اليوم</h3>
                <div id="todayPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-clock text-blue-500"></i> حتى الآن
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 107, 107, 0.1); color: var(--danger-color);">
                  <i class="fas fa-ambulance"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">حالات الطوارئ</h3>
                <div id="emergencyPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-exclamation-triangle text-yellow-500"></i> نشط
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8B5CF6;">
                  <i class="fas fa-procedures"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">العمليات المجدولة</h3>
                <div id="surgeryPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-calendar-alt text-purple-500"></i> هذا الأسبوع
                </div>
              </div>
            </div>
          </section>

          <!-- Charts Section -->
          <section class="mb-8 fade-in">
            <div class="chart-wrapper">
              <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                  <i class="fas fa-chart-line text-blue-600"></i>
                  التحليلات والإحصائيات الطبية
                </h2>
                <div class="flex gap-3 mt-4 lg:mt-0">
                  <button id="printReportBtn" class="btn-medical btn-sm">
                    <i class="fas fa-print"></i>
                    طباعة التقرير
                  </button>
                  <button id="exportPdfBtn" class="btn-medical btn-outline btn-sm">
                    <i class="fas fa-file-pdf"></i>
                    تصدير PDF
                  </button>
                </div>
              </div>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="chart-title">
                    <i class="fas fa-hospital"></i>
                    توزيع المرضى حسب الأقسام
                  </h3>
                  <div style="height: 250px;">
                    <canvas id="departmentChart"></canvas>
                  </div>
                </div>
                <div>
                  <h3 class="chart-title">
                    <i class="fas fa-calendar-day"></i>
                    معدل التسجيل اليومي
                  </h3>
                  <div style="height: 250px;">
                    <canvas id="dailyChart"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="mt-6">
                <h3 class="chart-title">
                  <i class="fas fa-tint"></i>
                  توزيع فصائل الدم
                </h3>
                <div style="height: 250px;">
                  <canvas id="bloodTypeChart"></canvas>
                </div>
              </div>
            </div>
          </section>
          
          <!-- Recent Activities -->
          <section class="mb-8 fade-in">
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-history"></i>
                  النشاطات الحديثة
                </h2>
                <button class="btn-medical btn-sm btn-outline">
                  <i class="fas fa-eye"></i>
                  عرض الكل
                </button>
              </div>
              <div class="card-body">
                <div class="space-y-4">
                  <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                      <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-sm font-medium">تم تسجيل مريض جديد: <span class="text-blue-600">أحمد محمد</span></p>
                      <p class="text-xs text-gray-500">منذ 5 دقائق</p>
                    </div>
                  </div>
                  
                  <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                      <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-sm font-medium">تم إكمال فحص الدم للمريض: <span class="text-green-600">فاطمة علي</span></p>
                      <p class="text-xs text-gray-500">منذ 15 دقيقة</p>
                    </div>
                  </div>
                  
                  <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-purple-600">
                      <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-sm font-medium">تم حجز موعد جديد: <span class="text-purple-600">محمد خالد</span></p>
                      <p class="text-xs text-gray-500">منذ 30 دقيقة</p>
                    </div>
                  </div>
                  
                  <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                      <i class="fas fa-procedures"></i>
                    </div>
                    <div class="flex-1">
                      <p class="text-sm font-medium">تم جدولة عملية جراحية: <span class="text-red-600">نورة سعيد</span></p>
                      <p class="text-xs text-gray-500">منذ ساعة</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
        
        <!-- Patients Registration Page -->
        <div id="patients-registrationPage" class="page">
          <div class="page-header">
            <h1 class="page-title">تسجيل مريض جديد</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">إدارة المرضى</span>
              <span class="breadcrumb-item">تسجيل مريض جديد</span>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Patient Registration Form -->
            <div class="lg:col-span-2">
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-user-plus"></i>
                    معلومات المريض الأساسية
                  </h2>
                </div>
                <div class="card-body">
                  <form id="patientForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-user ml-1"></i>
                          اسم المريض الكامل
                        </label>
                        <input type="text" id="name" class="form-input" placeholder="أدخل اسم المريض" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-id-card ml-1"></i>
                          الرقم القومي
                        </label>
                        <input type="text" id="nid" maxlength="14" class="form-input" placeholder="14 رقم" required />
                      </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-birthday-cake ml-1"></i>
                          تاريخ الميلاد
                        </label>
                        <input type="date" id="birthDate" class="form-input" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-venus-mars ml-1"></i>
                          الجنس
                        </label>
                        <select id="gender" class="form-input form-select" required>
                          <option value="">اختر</option>
                          <option value="male">ذكر</option>
                          <option value="female">أنثى</option>
                        </select>
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-tint ml-1"></i>
                          فصيلة الدم
                        </label>
                        <select id="bloodType" class="form-input form-select" required>
                          <option value="">اختر</option>
                          <option value="A+">A+</option>
                          <option value="A-">A-</option>
                          <option value="B+">B+</option>
                          <option value="B-">B-</option>
                          <option value="AB+">AB+</option>
                          <option value="AB-">AB-</option>
                          <option value="O+">O+</option>
                          <option value="O-">O-</option>
                        </select>
                      </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-phone ml-1"></i>
                          رقم الهاتف
                        </label>
                        <input type="tel" id="phone" class="form-input" placeholder="رقم الهاتف" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-envelope ml-1"></i>
                          البريد الإلكتروني
                        </label>
                        <input type="email" id="email" class="form-input" placeholder="البريد الإلكتروني" />
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-map-marker-alt ml-1"></i>
                        العنوان
                      </label>
                      <input type="text" id="address" class="form-input" placeholder="العنوان الكامل" required />
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-user-md ml-1"></i>
                        الطبيب المعالج
                      </label>
                      <select id="doctorSelect" class="form-input form-select">
                        <option value="">-- اختر الطبيب --</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-hospital ml-1"></i>
                        القسم الطبي
                      </label>
                      <select id="department" class="form-input form-select" required>
                        <option value="">-- اختر القسم --</option>
                        <option value="emergency">الطوارئ</option>
                        <option value="radiology">الأشعة</option>
                        <option value="icu">العناية المركزة</option>
                        <option value="operations">العمليات</option>
                        <option value="cardiology">أمراض القلب</option>
                        <option value="pediatrics">طب الأطفال</option>
                        <option value="obstetrics">أمراض النساء والتوليد</option>
                        <option value="orthopedics">العظام</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-notes-medical ml-1"></i>
                        الأمراض المزمنة / ملاحظات
                      </label>
                      <textarea id="diseases" rows="3" class="form-input" placeholder="أي أمراض مزمنة أو ملاحظات هامة"></textarea>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-shield-alt ml-1"></i>
                        معلومات التأمين الصحي
                      </label>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="insuranceCompany" class="form-input" placeholder="شركة التأمين" />
                        <input type="text" id="insuranceNumber" class="form-input" placeholder="رقم التأمين" />
                      </div>
                    </div>

                    <div class="flex gap-3">
                      <button type="submit" class="btn-medical">
                        <i class="fas fa-save"></i>
                        تسجيل المريض
                      </button>
                      <button type="button" id="resetFormBtn" class="btn-medical btn-outline">
                        <i class="fas fa-redo"></i>
                        إعادة تعيين
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="lg:col-span-1">
              <div class="medical-card mb-6">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-bolt"></i>
                    إجراءات سريعة
                  </h2>
                </div>
                <div class="card-body space-y-3">
                  <button class="btn-medical w-full btn-outline">
                    <i class="fas fa-camera"></i>
                    التقاط صورة للمريض
                  </button>
                  <button class="btn-medical w-full btn-outline">
                    <i class="fas fa-file-upload"></i>
                    رفع مستندات طبية
                  </button>
                  <button class="btn-medical w-full btn-outline">
                    <i class="fas fa-qrcode"></i>
                    إنشاء رمز QR للمريض
                  </button>
                </div>
              </div>
              
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    معلومات هامة
                  </h2>
                </div>
                <div class="card-body">
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-800">
                      <i class="fas fa-lightbulb ml-2"></i>
                      تأكد من إدخال جميع المعلومات الأساسية للمريض بشكل صحيح لتجنب أي مشاكل في المستقبل.
                    </p>
                  </div>
                  <div class="mt-4 space-y-2">
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>الرقم القومي مطلوب للتعرف على المريض</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>معلومات التأمين تساعد في الفواتير</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>يمكن إضافة ملاحظات طبية هامة</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Other pages will be added here -->
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading" class="loading-overlay hidden">
    <div class="text-center">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-lg font-semibold text-gray-700">جاري تحميل البيانات...</p>
    </div>
  </div>

  <script type="module">
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB4glqZb0hz1uvERtq0pSZZzeBy3_grAnQ",
  authDomain: "smart-life-hospital-ef64c.firebaseapp.com",
  databaseURL: "https://smart-life-hospital-ef64c-default-rtdb.firebaseio.com",
  projectId: "smart-life-hospital-ef64c",
  storageBucket: "smart-life-hospital-ef64c.firebasestorage.app",
  messagingSenderId: "851045891087",
  appId: "1:851045891087:web:8e0f6e42f8c7fed17bf77a",
  measurementId: "G-QE5BL3MTY7"
};
    
    // Initialize Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    
    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const mainApp = document.getElementById('mainApp');
    const loginForm = document.getElementById('loginForm');
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const menuToggle = document.getElementById('menuToggle');
    const userBtn = document.getElementById('userBtn');
    const userDropdown = document.getElementById('userDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    const pageContent = document.getElementById('pageContent');
    const loadingElement = document.getElementById('loading');
    const patientForm = document.getElementById('patientForm');
    const resetFormBtn = document.getElementById('resetFormBtn');
    const userName = document.getElementById('userName');
    
    // User state
    let currentUser = null;
    
    // Login functionality
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const userType = document.getElementById('userType').value;
      
      // Simple validation (in a real app, this would be authenticated against a backend)
      if (username && password && userType) {
        currentUser = {
          username,
          userType,
          name: username // In a real app, this would come from the user data
        };
        
        // Update UI with user info
        userName.textContent = currentUser.name;
        
        // Show main app
        loginScreen.classList.add('hidden');
        mainApp.classList.remove('hidden');
        
        // Initialize the app
        initializeApp();
        
        // Show welcome message
        Swal.fire({
          icon: 'success',
          title: 'مرحباً بك',
          text: `تم تسجيل الدخول بنجاح كـ${getUserTypeLabel(userType)}`,
          timer: 2000,
          showConfirmButton: false
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'خطأ في تسجيل الدخول',
          text: 'يرجى إدخال جميع البيانات المطلوبة'
        });
      }
    });
    
    // Logout functionality
    logoutBtn.addEventListener('click', () => {
      Swal.fire({
        title: 'تأكيد تسجيل الخروج',
        text: "هل أنت متأكد من تسجيل الخروج؟",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#0066CC',
        cancelButtonColor: '#6C757D',
        confirmButtonText: 'نعم، تسجيل الخروج',
        cancelButtonText: 'إلغاء'
      }).then((result) => {
        if (result.isConfirmed) {
          currentUser = null;
          mainApp.classList.add('hidden');
          loginScreen.classList.remove('hidden');
          loginForm.reset();
        }
      });
    });
    
    // User dropdown toggle
    userBtn.addEventListener('click', () => {
      userDropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userBtn.contains(e.target) && !userDropdown.contains(e.target)) {
        userDropdown.classList.remove('show');
      }
    });
    
    // Sidebar toggle
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('show');
      mainContent.classList.toggle('expanded');
    });
    
    // Sidebar menu items
    document.querySelectorAll('.sidebar-item[data-page]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const page = item.getAttribute('data-page');
        showPage(page);
        
        // Update active state
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Close sidebar on mobile
        if (window.innerWidth <= 1024) {
          sidebar.classList.remove('show');
        }
      });
    });
    
    // Sidebar submenu toggles
    document.querySelectorAll('.sidebar-item').forEach(item => {
      if (item.id && item.id.includes('Menu')) {
        item.addEventListener('click', () => {
          const submenuId = item.id.replace('Menu', 'Submenu');
          const submenu = document.getElementById(submenuId);
          if (submenu) {
            submenu.classList.toggle('open');
          }
        });
      }
    });
    
    // Sidebar submenu items
    document.querySelectorAll('.sidebar-submenu-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const page = item.getAttribute('data-page');
        showPage(page);
        
        // Update active state
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.sidebar-submenu-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Close sidebar on mobile
        if (window.innerWidth <= 1024) {
          sidebar.classList.remove('show');
        }
      });
    });
    
    // Show page function
    function showPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // Show the selected page
      const targetPage = document.getElementById(`${pageId}Page`);
      if (targetPage) {
        targetPage.classList.add('active');
      } else {
        // If page doesn't exist, show a placeholder
        const placeholder = document.createElement('div');
        placeholder.className = 'page active';
        placeholder.innerHTML = `
          <div class="page-header">
            <h1 class="page-title">${getPageTitle(pageId)}</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">${getPageTitle(pageId)}</span>
            </div>
          </div>
          <div class="medical-card">
            <div class="card-body text-center py-12">
              <i class="fas fa-tools text-6xl text-gray-300 mb-4"></i>
              <h2 class="text-xl font-bold text-gray-700 mb-2">هذه الصفحة قيد التطوير</h2>
              <p class="text-gray-500">سيتم إضافة محتوى هذه الصفحة قريباً</p>
            </div>
          </div>
        `;
        pageContent.appendChild(placeholder);
      }
    }
    
    // Get page title
    function getPageTitle(pageId) {
      const titles = {
        'dashboard': 'لوحة التحكم',
        'patients-registration': 'تسجيل مريض جديد',
        'patients-list': 'قائمة المرضى',
        'patients-search': 'بحث متقدم',
        'appointments-schedule': 'جدولة المواعيد',
        'appointments-list': 'قائمة المواعيد',
        'appointments-calendar': 'التقويم',
        'medical-records': 'السجلات الطبية',
        'prescriptions': 'الوصفات الطبية',
        'lab-results': 'نتائج المختبر',
        'radiology': 'الأشعة',
        'rooms': 'الغرف والأسرّة',
        'departments': 'الأقسام',
        'staff': 'الموظفين',
        'doctors': 'الأطباء',
        'pharmacy-inventory': 'مخزون الصيدلية',
        'pharmacy-prescriptions': 'وصفات الصيدلية',
        'billing-invoices': 'الفواتير',
        'billing-insurance': 'التأمين الصحي',
        'billing-payments': 'المدفوعات',
        'reports': 'التقارير',
        'settings': 'الإعدادات'
      };
      return titles[pageId] || pageId;
    }
    
    // Get user type label
    function getUserTypeLabel(userType) {
      const labels = {
        'admin': 'مدير النظام',
        'doctor': 'طبيب',
        'nurse': 'ممرض',
        'reception': 'موظف استقبال',
        'lab': 'فني مختبر',
        'pharmacy': 'صيدلي'
      };
      return labels[userType] || userType;
    }
    
    // Initialize app
    function initializeApp() {
      // Load doctors
      loadDoctors();
      
      // Initialize charts
      initializeCharts();
      
      // Setup data listeners
      setupDataListeners();
      
      // Update stats
      updateStats();
    }
    
    // Show loading overlay
    function showLoading() {
      loadingElement.classList.remove('hidden');
    }
    
    // Hide loading overlay
    function hideLoading() {
      loadingElement.classList.add('hidden');
    }
    
    // Format date for display
    function formatDate(timestamp) {
      return new Date(timestamp).toLocaleString("ar-EG", {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit'
      });
    }
    
    // Load doctors from database
    function loadDoctors() {
      const doctorsRef = ref(db, "doctors");
      
      onValue(doctorsRef, (snapshot) => {
        const doctors = snapshot.val() || {};
        
        // Clear current options except the default one
        const doctorSelect = document.getElementById('doctorSelect');
        if (doctorSelect) {
          doctorSelect.innerHTML = '<option value="">-- اختر الطبيب --</option>';
          
          // Add doctors to the select
          Object.entries(doctors).forEach(([id, doctor]) => {
            const option = document.createElement("option");
            option.value = id;
            option.textContent = `${doctor.name} - ${getDepartmentName(doctor.department)}`;
            doctorSelect.appendChild(option);
          });
        }
      });
    }
    
    // Add sample doctors (run once)
    function addSampleDoctors() {
      const doctorsRef = ref(db, "doctors");
      
      const sampleDoctors = [
        { name: "د. أحمد محمد", department: "emergency", specialization: "طب الطوارئ" },
        { name: "د. فاطمة علي", department: "icu", specialization: "العناية المركزة" },
        { name: "د. محمد خالد", department: "operations", specialization: "جراحة عامة" },
        { name: "د. نورة سعيد", department: "radiology", specialization: "الأشعة التشخيصية" },
        { name: "د. يوسف عمر", department: "emergency", specialization: "طب الطوارئ" },
        { name: "د. مريم حسن", department: "icu", specialization: "العناية المركزة" }
      ];
      
      sampleDoctors.forEach(doctor => {
        push(doctorsRef, doctor);
      });
    }
    
    // Get department name
    function getDepartmentName(department) {
      const departments = {
        emergency: 'الطوارئ',
        icu: 'العناية المركزة',
        surgery: 'العمليات',
        care: 'الرعاية',
        admin: 'الإدارة',
        radiology: 'الأشعة',
        operations: 'العمليات',
        cardiology: 'أمراض القلب',
        pediatrics: 'طب الأطفال',
        obstetrics: 'أمراض النساء والتوليد',
        orthopedics: 'العظام'
      };
      return departments[department] || department;
    }
    
    // Form submission
    patientForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const selectedDoctor = document.getElementById("doctorSelect").value;
      let doctorName = '';
      
      // Get doctor name if a doctor is selected
      if (selectedDoctor) {
        const selectedOption = doctorSelect.options[doctorSelect.selectedIndex];
        doctorName = selectedOption.textContent.split(' - ')[0];
      }
      
      // Calculate age from birth date
      const birthDate = new Date(document.getElementById("birthDate").value);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      const formData = {
        name: document.getElementById("name").value.trim(),
        nid: document.getElementById("nid").value.trim(),
        birthDate: document.getElementById("birthDate").value,
        age: age,
        gender: document.getElementById("gender").value,
        bloodType: document.getElementById("bloodType").value,
        phone: document.getElementById("phone").value.trim(),
        email: document.getElementById("email").value.trim(),
        address: document.getElementById("address").value.trim(),
        diseases: document.getElementById("diseases").value.trim(),
        department: document.getElementById("department").value,
        doctorId: selectedDoctor,
        doctorName: doctorName,
        insuranceCompany: document.getElementById("insuranceCompany").value.trim(),
        insuranceNumber: document.getElementById("insuranceNumber").value.trim(),
        timestamp: new Date().toISOString()
      };
      
      if (!formData.name || !formData.nid || !formData.birthDate || !formData.gender || 
          !formData.bloodType || !formData.phone || !formData.address || !formData.department) {
        Swal.fire({
          icon: 'warning',
          title: 'بيانات ناقصة',
          text: 'يرجى ملء جميع الحقول الإلزامية',
          confirmButtonText: 'حسناً'
        });
        return;
      }
      
      try {
        showLoading();
        const patientsRef = ref(db, `patients/${formData.department}`);
        await push(patientsRef, formData);
        
        Swal.fire({
          icon: 'success',
          title: 'تم التسجيل بنجاح',
          text: `تم تسجيل المريض ${formData.name}`,
          timer: 2000,
          showConfirmButton: false,
          position: 'top-end',
          toast: true
        });
        
        patientForm.reset();
        hideLoading();
      } catch (error) {
        hideLoading();
        Swal.fire({
          icon: 'error',
          title: 'خطأ',
          text: 'حدث خطأ أثناء التسجيل'
        });
      }
    });
    
    // Reset form button
    resetFormBtn.addEventListener('click', () => {
      patientForm.reset();
    });
    
    // Update statistics
    function updateStats() {
      showLoading();
      const todayDate = new Date().toDateString();
      let total = 0, today = 0, emergency = 0, surgery = 0;
      
      onValue(ref(db, "patients"), (snapshot) => {
        const data = snapshot.val() || {};
        
        Object.values(data).forEach(dept => {
          Object.values(dept).forEach(patient => {
            total++;
            if (new Date(patient.timestamp).toDateString() === todayDate) today++;
            if (patient.department === 'emergency') emergency++;
            if (patient.department === 'surgery' || patient.department === 'operations') surgery++;
          });
        });
        
        const totalPatientsElement = document.getElementById('totalPatients');
        const todayPatientsElement = document.getElementById('todayPatients');
        const emergencyPatientsElement = document.getElementById('emergencyPatients');
        const surgeryPatientsElement = document.getElementById('surgeryPatients');
        
        if (totalPatientsElement) totalPatientsElement.textContent = total;
        if (todayPatientsElement) todayPatientsElement.textContent = today;
        if (emergencyPatientsElement) emergencyPatientsElement.textContent = emergency;
        if (surgeryPatientsElement) surgeryPatientsElement.textContent = surgery;
        
        hideLoading();
      });
    }
    
    // Initialize charts
    function initializeCharts() {
      // Department distribution chart
      const deptCtx = document.getElementById('departmentChart');
      if (deptCtx) {
        const deptChart = new Chart(deptCtx.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['الطوارئ', 'العناية المركزة', 'العمليات', 'الرعاية', 'الإدارة', 'الأشعة'],
            datasets: [{
              label: 'عدد المرضى',
              data: [0, 0, 0, 0, 0, 0],
              backgroundColor: [
                'rgba(255, 107, 107, 0.7)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(0, 102, 204, 0.7)',
                'rgba(107, 207, 127, 0.7)',
                'rgba(108, 117, 125, 0.7)',
                'rgba(14, 165, 233, 0.7)'
              ],
              borderColor: [
                'rgb(255, 107, 107)',
                'rgb(139, 92, 246)',
                'rgb(0, 102, 204)',
                'rgb(107, 207, 127)',
                'rgb(108, 117, 125)',
                'rgb(14, 165, 233)'
              ],
              borderWidth: 1,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                },
                grid: {
                  borderDash: [5, 5]
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const deptCounts = [0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const deptIndex = getDepartmentIndex(patient.department);
              if (deptIndex !== -1) deptCounts[deptIndex]++;
            });
          });
          
          deptChart.data.datasets[0].data = deptCounts;
          deptChart.update();
        });
      }
      
      // Daily patients chart
      const dailyCtx = document.getElementById('dailyChart');
      if (dailyCtx) {
        const dailyChart = new Chart(dailyCtx.getContext('2d'), {
          type: 'line',
          data: {
            labels: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],
            datasets: [{
              label: 'عدد المرضى',
              data: [0, 0, 0, 0, 0, 0, 0],
              fill: true,
              backgroundColor: 'rgba(0, 102, 204, 0.1)',
              borderColor: 'rgb(0, 102, 204)',
              tension: 0.4,
              pointBackgroundColor: 'rgb(0, 102, 204)',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                },
                grid: {
                  borderDash: [5, 5]
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const dailyCounts = [0, 0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const patientDate = new Date(patient.timestamp);
              const patientDay = patientDate.getDay();
              if (patientDay >= 0 && patientDay <= 6) {
                dailyCounts[patientDay]++;
              }
            });
          });
          
          dailyChart.data.datasets[0].data = dailyCounts;
          dailyChart.update();
        });
      }
      
      // Blood type distribution chart
      const bloodCtx = document.getElementById('bloodTypeChart');
      if (bloodCtx) {
        const bloodChart = new Chart(bloodCtx.getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'],
            datasets: [{
              label: 'فصيلة الدم',
              data: [0, 0, 0, 0, 0, 0, 0, 0],
              backgroundColor: [
                'rgba(255, 107, 107, 0.7)',
                'rgba(255, 107, 107, 0.5)',
                'rgba(0, 102, 204, 0.7)',
                'rgba(0, 102, 204, 0.5)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(139, 92, 246, 0.5)',
                'rgba(107, 207, 127, 0.7)',
                'rgba(107, 207, 127, 0.5)'
              ],
              borderColor: '#fff',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  padding: 15,
                  font: {
                    size: 12
                  }
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const bloodCounts = [0, 0, 0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const bloodIndex = getBloodTypeIndex(patient.bloodType);
              if (bloodIndex !== -1) bloodCounts[bloodIndex]++;
            });
          });
          
          bloodChart.data.datasets[0].data = bloodCounts;
          bloodChart.update();
        });
      }
    }
    
    // Helper functions
    function getDepartmentIndex(department) {
      const departments = ['emergency', 'icu', 'surgery', 'care', 'admin', 'radiology'];
      return departments.indexOf(department);
    }
    
    function getBloodTypeIndex(bloodType) {
      const bloodTypes = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
      return bloodTypes.indexOf(bloodType);
    }
    
    // Setup data listeners
    function setupDataListeners() {
      // This function will be expanded to include more data listeners
      // for different parts of the application
    }
    
    // Print report function
    const printReportBtn = document.getElementById('printReportBtn');
    if (printReportBtn) {
      printReportBtn.addEventListener('click', () => {
        window.print();
      });
    }
    
    // Export PDF function
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    if (exportPdfBtn) {
      exportPdfBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFont('Cairo', 'normal');
        doc.setFontSize(18);
        doc.text('تقرير المرضى - مستشفى الحياة الذكية', 105, 15, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text(`التاريخ: ${new Date().toLocaleDateString("ar-EG")}`, 105, 25, { align: 'center' });
        
        doc.setFontSize(14);
        doc.text('قائمة المرضى', 20, 40);
        
        doc.setFontSize(10);
        let y = 50;
        
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          let patientCount = 0;
          
          Object.entries(data).forEach(([dept, patients]) => {
            Object.entries(patients).forEach(([id, patient]) => {
              if (patientCount > 0) y += 10;
              doc.text(`${patientCount + 1}. ${patient.name} - ${dept}`, 20, y);
              doc.text(`   العمر: ${patient.age} | الجنس: ${patient.gender === 'male' ? 'ذكر' : 'أنثى'} | الرقم القومي: ${patient.nid}`, 20, y + 5);
              patientCount++;
            });
          });
          
          doc.save('تقرير-المرضى.pdf');
          hideLoading();
        });
        
        showLoading();
      });
    }
  </script>
</body>
</html>
