<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyArPFi04c_vDP5Gi8bM4pem_LuvMx_eJG0",
    authDomain: "hospital-project-e4b59.firebaseapp.com",
    databaseURL: "https://hospital-project-e4b59-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "hospital-project-e4b59",
    storageBucket: "hospital-project-e4b59.appspot.com",
    messagingSenderId: "974610606258",
    appId: "1:974610606258:web:71ce7d5d447bca4b4441ab",
    measurementId: "G-0GV30LL28T"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.getElementById("patientForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const nid = document.getElementById("nid").value.trim();
    const department = document.getElementById("department").value;
    const id = Math.floor(100000 + Math.random() * 900000).toString(); // رقم مريض عشوائي

    if (!name || !age || !nid || !department) {
      alert("يرجى ملء جميع الحقول");
      return;
    }

    const patient = {
      name,
      age,
      nid,
      department,
      id,
      timestamp: new Date().toISOString()
    };

    try {
      await addDoc(collection(db, "patients"), patient);
      alert("✅ تم تسجيل المريض وتحويله إلى قسم " + department);
      this.reset();
    } catch (error) {
      console.error(error);
      alert("❌ حدث خطأ أثناء التسجيل");
    }
  });
</script>
