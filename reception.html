<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نظام إدارة المستشفى المتكامل - مستشفى الحياة الذكية</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0066CC;
      --primary-hover: #004499;
      --secondary-color: #00A8E8;
      --accent-color: #00C9A7;
      --danger-color: #FF6B6B;
      --warning-color: #FFD93D;
      --success-color: #6BCF7F;
      --dark-color: #2C3E50;
      --light-bg: #F0F8FF;
      --card-bg: #FFFFFF;
      --text-primary: #2C3E50;
      --text-secondary: #6C757D;
      --border-color: #E1E8ED;
      --shadow-sm: 0 2px 4px rgba(0, 102, 204, 0.08);
      --shadow-md: 0 4px 12px rgba(0, 102, 204, 0.12);
      --shadow-lg: 0 8px 24px rgba(0, 102, 204, 0.16);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Cairo', sans-serif; 
      background: linear-gradient(135deg, #F0F8FF 0%, #E6F4F9 100%);
      min-height: 100vh;
      color: var(--text-primary);
    }
    
    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      right: 0;
      height: 100vh;
      width: 260px;
      background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      z-index: 1000;
      transform: translateX(0);
      transition: transform 0.3s ease;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }
    
    .sidebar.collapsed {
      transform: translateX(100%);
    }
    
    .sidebar-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: white;
      margin: 0 auto 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
    }
    
    .sidebar-menu {
      padding: 20px 0;
    }
    
    .sidebar-item {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
    }
    
    .sidebar-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-item.active {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .sidebar-item.active::before {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: white;
    }
    
    .sidebar-item i {
      margin-left: 15px;
      font-size: 18px;
    }
    
    .sidebar-text {
      font-size: 16px;
      font-weight: 500;
    }
    
    .sidebar-submenu {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
      background: rgba(0, 0, 0, 0.1);
    }
    
    .sidebar-submenu.open {
      max-height: 500px;
    }
    
    .sidebar-submenu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px 12px 50px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .sidebar-submenu-item:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    /* Main Content Styles */
    .main-content {
      margin-right: 260px;
      transition: margin-right 0.3s ease;
      min-height: 100vh;
    }
    
    .main-content.expanded {
      margin-right: 0;
    }
    
    /* Header Styles */
    .medical-header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    
    .medical-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,133.3C960,128,1056,96,1152,90.7C1248,85,1344,107,1392,117.3L1440,128L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z"></path></svg>') no-repeat;
      background-size: cover;
      opacity: 0.3;
    }
    
    .header-content {
      position: relative;
      z-index: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
    }
    
    .menu-toggle {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .menu-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .notification-btn {
      position: relative;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .notification-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
    }
    
    .user-dropdown {
      position: relative;
    }
    
    .user-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .user-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-weight: bold;
    }
    
    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      background: white;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      min-width: 200px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    
    .dropdown-menu.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      color: var(--text-primary);
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .dropdown-item:hover {
      background: var(--light-bg);
    }
    
    .dropdown-divider {
      height: 1px;
      background: var(--border-color);
      margin: 5px 0;
    }
    
    /* Page Content Styles */
    .page-content {
      padding: 20px;
    }
    
    .page-header {
      margin-bottom: 20px;
    }
    
    .page-title {
      font-size: 24px;
      font-weight: bold;
      color: var(--text-primary);
      margin-bottom: 5px;
    }
    
    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .breadcrumb-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .breadcrumb-item:not(:last-child)::after {
      content: '/';
      margin-right: 5px;
    }
    
    /* Card Styles */
    .medical-card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }
    
    .medical-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .medical-card:hover::before {
      opacity: 1;
    }
    
    .medical-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    
    .card-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-title i {
      color: var(--primary-color);
    }
    
    .card-body {
      padding: 20px;
    }
    
    /* Stat Cards */
    .stat-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0,102,204,0.05) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .stat-card:hover::after {
      opacity: 1;
    }
    
    .stat-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-md);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 16px;
    }
    
    /* Buttons */
    .btn-medical {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-sm);
    }
    
    .btn-medical:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      background: linear-gradient(135deg, var(--primary-hover), var(--secondary-color));
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
    }
    
    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-sm {
      padding: 8px 16px;
      font-size: 14px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
    }
    
    .form-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%230066CC'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left 12px center;
      background-size: 20px;
      padding-left: 40px;
    }
    
    /* Table Styles */
    .medical-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .medical-table th {
      background: var(--light-bg);
      padding: 12px 15px;
      text-align: right;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 2px solid var(--border-color);
    }
    
    .medical-table td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .medical-table tr:hover {
      background: rgba(0, 102, 204, 0.05);
    }
    
    /* Tab Styles */
    .tab-container {
      margin-bottom: 20px;
    }
    
    .tab-nav {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 20px;
    }
    
    .tab-btn {
      background: none;
      border: none;
      padding: 12px 20px;
      font-weight: 600;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .tab-btn:hover {
      color: var(--primary-color);
    }
    
    .tab-btn.active {
      color: var(--primary-color);
    }
    
    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      right: 0;
      left: 0;
      height: 2px;
      background: var(--primary-color);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    
    /* Modal Styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    
    .modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    
    .modal.show .modal-content {
      transform: scale(1);
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: bold;
      color: var(--text-primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      color: var(--text-secondary);
      cursor: pointer;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .modal-close:hover {
      background: var(--light-bg);
      color: var(--danger-color);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    /* Loading Overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--border-color);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Chart Container */
    .chart-wrapper {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 24px;
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chart-title i {
      color: var(--primary-color);
    }
    
    /* Department Badge */
    .dept-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .dept-emergency {
      background: rgba(255, 107, 107, 0.1);
      color: var(--danger-color);
    }
    
    .dept-icu {
      background: rgba(139, 92, 246, 0.1);
      color: #8B5CF6;
    }
    
    .dept-surgery {
      background: rgba(0, 102, 204, 0.1);
      color: var(--primary-color);
    }
    
    .dept-radiology {
      background: rgba(14, 165, 233, 0.1);
      color: #0EA5E9;
    }
    
    /* Patient Card */
    .patient-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      position: relative;
    }
    
    .patient-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--primary-color), var(--secondary-color));
      border-radius: 4px 0 0 4px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .patient-card:hover::before {
      opacity: 1;
    }
    
    .patient-card:hover {
      transform: translateX(4px);
      box-shadow: var(--shadow-md);
    }
    
    .patient-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 18px;
    }
    
    .patient-info {
      flex: 1;
    }
    
    .patient-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .patient-details {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    
    .detail-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .detail-item i {
      color: var(--primary-color);
    }
    
    /* Action Buttons */
    .action-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      margin: 0 4px;
    }
    
    .action-btn:hover {
      transform: scale(1.1);
    }
    
    .btn-edit {
      background: rgba(0, 102, 204, 0.1);
      color: var(--primary-color);
    }
    
    .btn-edit:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-delete {
      background: rgba(255, 107, 107, 0.1);
      color: var(--danger-color);
    }
    
    .btn-delete:hover {
      background: var(--danger-color);
      color: white;
    }
    
    /* Search Box */
    .search-container {
      position: relative;
    }
    
    .search-input {
      padding-right: 44px;
      padding-left: 16px;
    }
    
    .search-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(100%);
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .main-content {
        margin-right: 0;
      }
    }
    
    @media (max-width: 768px) {
      .stat-card {
        margin-bottom: 16px;
      }
      
      .header-content {
        padding: 15px;
      }
      
      .page-content {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <!-- Main Application -->
  <div id="mainApp">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <img src="https://t90121098672.p.clickup-attachments.com/t90121098672/aab7a4bd-0c9c-438c-8bfa-b5b1ec339843/generated-image-05102b72-8a2a-485a-9362-1371947b2a5a.png?view=open" 
               class="w-14 h-14 rounded-full" alt="شعار المستشفى">
        </div>
        <h3 class="text-white font-bold">مستشفى الحياة الذكية</h3>
        <p class="text-white text-xs opacity-80">نظام إدارة المستشفى</p>
      </div>
      <nav class="sidebar-menu">
        <a href="#" class="sidebar-item active" data-page="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span class="sidebar-text">لوحة التحكم</span>
        </a>
        
        <div class="sidebar-item" id="patientsMenu">
          <i class="fas fa-users"></i>
          <span class="sidebar-text">إدارة المرضى</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="patientsSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="patients-registration">تسجيل مريض جديد</a>
          <a href="#" class="sidebar-submenu-item" data-page="patients-list">قائمة المرضى</a>
          <a href="#" class="sidebar-submenu-item" data-page="patients-search">بحث متقدم</a>
        </div>
        
        <div class="sidebar-item" id="appointmentsMenu">
          <i class="fas fa-calendar-check"></i>
          <span class="sidebar-text">المواعيد</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="appointmentsSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="appointments-schedule">جدولة المواعيد</a>
          <a href="#" class="sidebar-submenu-item" data-page="appointments-list">قائمة المواعيد</a>
          <a href="#" class="sidebar-submenu-item" data-page="appointments-calendar">التقويم</a>
        </div>
        
        <div class="sidebar-item" id="medicalMenu">
          <i class="fas fa-notes-medical"></i>
          <span class="sidebar-text">السجلات الطبية</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="medicalSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="medical-records">السجلات الطبية</a>
          <a href="#" class="sidebar-submenu-item" data-page="prescriptions">الوصفات الطبية</a>
          <a href="#" class="sidebar-submenu-item" data-page="lab-results">نتائج المختبر</a>
          <a href="#" class="sidebar-submenu-item" data-page="radiology">الأشعة</a>
        </div>
        
        <div class="sidebar-item" id="hospitalMenu">
          <i class="fas fa-hospital"></i>
          <span class="sidebar-text">إدارة المستشفى</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="hospitalSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="rooms">الغرف والأسرّة</a>
          <a href="#" class="sidebar-submenu-item" data-page="departments">الأقسام</a>
          <a href="#" class="sidebar-submenu-item" data-page="staff">الموظفين</a>
          <a href="#" class="sidebar-submenu-item" data-page="doctors">الأطباء</a>
        </div>
        
        <div class="sidebar-item" id="pharmacyMenu">
          <i class="fas fa-pills"></i>
          <span class="sidebar-text">الصيدلية</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="pharmacySubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="pharmacy-inventory">المخزون</a>
          <a href="#" class="sidebar-submenu-item" data-page="pharmacy-prescriptions">الوصفات</a>
        </div>
        
        <div class="sidebar-item" id="billingMenu">
          <i class="fas fa-file-invoice-dollar"></i>
          <span class="sidebar-text">الفواتير والتأمين</span>
          <i class="fas fa-chevron-down mr-auto"></i>
        </div>
        <div class="sidebar-submenu" id="billingSubmenu">
          <a href="#" class="sidebar-submenu-item" data-page="billing-invoices">الفواتير</a>
          <a href="#" class="sidebar-submenu-item" data-page="billing-insurance">التأمين الصحي</a>
          <a href="#" class="sidebar-submenu-item" data-page="billing-payments">المدفوعات</a>
        </div>
        
        <a href="#" class="sidebar-item" data-page="reports">
          <i class="fas fa-chart-bar"></i>
          <span class="sidebar-text">التقارير</span>
        </a>
        
        <a href="#" class="sidebar-item" data-page="settings">
          <i class="fas fa-cog"></i>
          <span class="sidebar-text">الإعدادات</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <div id="mainContent" class="main-content">
      <!-- Header -->
      <header class="medical-header">
        <div class="header-content">
          <button id="menuToggle" class="menu-toggle">
            <i class="fas fa-bars"></i>
          </button>
          
          <div class="header-actions">
            <button class="notification-btn">
              <i class="fas fa-bell"></i>
              <span class="notification-badge" id="notificationCount">0</span>
            </button>
            
            <div class="user-dropdown">
              <button id="userBtn" class="user-btn">
                <div class="user-avatar">م</div>
                <span id="userName">مدير النظام</span>
                <i class="fas fa-chevron-down"></i>
              </button>
              <div id="userDropdown" class="dropdown-menu">
                <a href="#" class="dropdown-item">
                  <i class="fas fa-user"></i>
                  <span>الملف الشخصي</span>
                </a>
                <a href="#" class="dropdown-item">
                  <i class="fas fa-cog"></i>
                  <span>الإعدادات</span>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" id="logoutBtn" class="dropdown-item">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>خروج</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div id="pageContent" class="page-content">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page active">
          <div class="page-header">
            <h1 class="page-title">لوحة التحكم</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">لوحة التحكم</span>
            </div>
          </div>
          
          <!-- Statistics Dashboard -->
          <section class="mb-8 fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(0, 102, 204, 0.1); color: var(--primary-color);">
                  <i class="fas fa-users"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">إجمالي المرضى</h3>
                <div id="totalPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-arrow-up text-green-500"></i> هذا الشهر
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(107, 207, 127, 0.1); color: var(--success-color);">
                  <i class="fas fa-user-plus"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">المسجلين اليوم</h3>
                <div id="todayPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-clock text-blue-500"></i> حتى الآن
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 107, 107, 0.1); color: var(--danger-color);">
                  <i class="fas fa-ambulance"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">حالات الطوارئ</h3>
                <div id="emergencyPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-exclamation-triangle text-yellow-500"></i> نشط
                </div>
              </div>
              
              <div class="stat-card">
                <div class="stat-icon" style="background: rgba(139, 92, 246, 0.1); color: #8B5CF6;">
                  <i class="fas fa-procedures"></i>
                </div>
                <h3 class="text-sm font-semibold text-gray-600 mb-2">العمليات المجدولة</h3>
                <div id="surgeryPatients" class="text-3xl font-bold text-gray-800">0</div>
                <div class="text-xs text-gray-500 mt-2">
                  <i class="fas fa-calendar-alt text-purple-500"></i> هذا الأسبوع
                </div>
              </div>
            </div>
          </section>

          <!-- Charts Section -->
          <section class="mb-8 fade-in">
            <div class="chart-wrapper">
              <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-6">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                  <i class="fas fa-chart-line text-blue-600"></i>
                  التحليلات والإحصائيات الطبية
                </h2>
                <div class="flex gap-3 mt-4 lg:mt-0">
                  <button id="printReportBtn" class="btn-medical btn-sm">
                    <i class="fas fa-print"></i>
                    طباعة التقرير
                  </button>
                  <button id="exportPdfBtn" class="btn-medical btn-outline btn-sm">
                    <i class="fas fa-file-pdf"></i>
                    تصدير PDF
                  </button>
                </div>
              </div>
              
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="chart-title">
                    <i class="fas fa-hospital"></i>
                    توزيع المرضى حسب الأقسام
                  </h3>
                  <div style="height: 250px;">
                    <canvas id="departmentChart"></canvas>
                  </div>
                </div>
                <div>
                  <h3 class="chart-title">
                    <i class="fas fa-calendar-day"></i>
                    معدل التسجيل اليومي
                  </h3>
                  <div style="height: 250px;">
                    <canvas id="dailyChart"></canvas>
                  </div>
                </div>
              </div>
              
              <div class="mt-6">
                <h3 class="chart-title">
                  <i class="fas fa-tint"></i>
                  توزيع فصائل الدم
                </h3>
                <div style="height: 250px;">
                  <canvas id="bloodTypeChart"></canvas>
                </div>
              </div>
            </div>
          </section>
          
          <!-- Recent Activities -->
          <section class="mb-8 fade-in">
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-history"></i>
                  النشاطات الحديثة
                </h2>
                <button class="btn-medical btn-sm btn-outline" onclick="viewAllActivities()">
                  <i class="fas fa-eye"></i>
                  عرض الكل
                </button>
              </div>
              <div class="card-body">
                <div id="recentActivities" class="space-y-4">
                  <!-- Activities will be loaded here -->
                </div>
              </div>
            </div>
          </section>
        </div>
        
        <!-- Patients Registration Page -->
        <div id="patients-registrationPage" class="page">
          <div class="page-header">
            <h1 class="page-title">تسجيل مريض جديد</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">إدارة المرضى</span>
              <span class="breadcrumb-item">تسجيل مريض جديد</span>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Patient Registration Form -->
            <div class="lg:col-span-2">
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-user-plus"></i>
                    معلومات المريض الأساسية
                  </h2>
                </div>
                <div class="card-body">
                  <form id="patientForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-user ml-1"></i>
                          اسم المريض الكامل
                        </label>
                        <input type="text" id="name" class="form-input" placeholder="أدخل اسم المريض" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-id-card ml-1"></i>
                          الرقم القومي
                        </label>
                        <input type="text" id="nid" maxlength="14" class="form-input" placeholder="14 رقم" required />
                      </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-birthday-cake ml-1"></i>
                          تاريخ الميلاد
                        </label>
                        <input type="date" id="birthDate" class="form-input" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-venus-mars ml-1"></i>
                          الجنس
                        </label>
                        <select id="gender" class="form-input form-select" required>
                          <option value="">اختر</option>
                          <option value="male">ذكر</option>
                          <option value="female">أنثى</option>
                        </select>
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-tint ml-1"></i>
                          فصيلة الدم
                        </label>
                        <select id="bloodType" class="form-input form-select" required>
                          <option value="">اختر</option>
                          <option value="A+">A+</option>
                          <option value="A-">A-</option>
                          <option value="B+">B+</option>
                          <option value="B-">B-</option>
                          <option value="AB+">AB+</option>
                          <option value="AB-">AB-</option>
                          <option value="O+">O+</option>
                          <option value="O-">O-</option>
                        </select>
                      </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-phone ml-1"></i>
                          رقم الهاتف
                        </label>
                        <input type="tel" id="phone" class="form-input" placeholder="رقم الهاتف" required />
                      </div>
                      
                      <div class="form-group">
                        <label class="form-label">
                          <i class="fas fa-envelope ml-1"></i>
                          البريد الإلكتروني
                        </label>
                        <input type="email" id="email" class="form-input" placeholder="البريد الإلكتروني" />
                      </div>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-map-marker-alt ml-1"></i>
                        العنوان
                      </label>
                      <input type="text" id="address" class="form-input" placeholder="العنوان الكامل" required />
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-user-md ml-1"></i>
                        الطبيب المعالج
                      </label>
                      <select id="doctorSelect" class="form-input form-select">
                        <option value="">-- اختر الطبيب --</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-hospital ml-1"></i>
                        القسم الطبي
                      </label>
                      <select id="department" class="form-input form-select" required>
                        <option value="">-- اختر القسم --</option>
                        <option value="emergency">الطوارئ</option>
                        <option value="radiology">الأشعة</option>
                        <option value="icu">العناية المركزة</option>
                        <option value="operations">العمليات</option>
                        <option value="cardiology">أمراض القلب</option>
                        <option value="pediatrics">طب الأطفال</option>
                        <option value="obstetrics">أمراض النساء والتوليد</option>
                        <option value="orthopedics">العظام</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-notes-medical ml-1"></i>
                        الأمراض المزمنة / ملاحظات
                      </label>
                      <textarea id="diseases" rows="3" class="form-input" placeholder="أي أمراض مزمنة أو ملاحظات هامة"></textarea>
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-shield-alt ml-1"></i>
                        معلومات التأمين الصحي
                      </label>
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="insuranceCompany" class="form-input" placeholder="شركة التأمين" />
                        <input type="text" id="insuranceNumber" class="form-input" placeholder="رقم التأمين" />
                      </div>
                    </div>

                    <div class="flex gap-3">
                      <button type="submit" class="btn-medical">
                        <i class="fas fa-save"></i>
                        تسجيل المريض
                      </button>
                      <button type="button" id="resetFormBtn" class="btn-medical btn-outline">
                        <i class="fas fa-redo"></i>
                        إعادة تعيين
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="lg:col-span-1">
              <div class="medical-card mb-6">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-bolt"></i>
                    إجراءات سريعة
                  </h2>
                </div>
                <div class="card-body space-y-3">
                  <button class="btn-medical w-full btn-outline" onclick="capturePatientPhoto()">
                    <i class="fas fa-camera"></i>
                    التقاط صورة للمريض
                  </button>
                  <button class="btn-medical w-full btn-outline" onclick="uploadMedicalDocuments()">
                    <i class="fas fa-file-upload"></i>
                    رفع مستندات طبية
                  </button>
                  <button class="btn-medical w-full btn-outline" onclick="generatePatientQR()">
                    <i class="fas fa-qrcode"></i>
                    إنشاء رمز QR للمريض
                  </button>
                </div>
              </div>
              
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-info-circle"></i>
                    معلومات هامة
                  </h2>
                </div>
                <div class="card-body">
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-800">
                      <i class="fas fa-lightbulb ml-2"></i>
                      تأكد من إدخال جميع المعلومات الأساسية للمريض بشكل صحيح لتجنب أي مشاكل في المستقبل.
                    </p>
                  </div>
                  <div class="mt-4 space-y-2">
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>الرقم القومي مطلوب للتعرف على المريض</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>معلومات التأمين تساعد في الفواتير</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                      <i class="fas fa-check-circle text-green-500"></i>
                      <span>يمكن إضافة ملاحظات طبية هامة</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Patients List Page -->
        <div id="patients-listPage" class="page">
          <div class="page-header">
            <h1 class="page-title">قائمة المرضى</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">إدارة المرضى</span>
              <span class="breadcrumb-item">قائمة المرضى</span>
            </div>
          </div>
          
          <div class="medical-card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-list-ul"></i>
                جميع المرضى المسجلين
              </h2>
              <div class="flex gap-3">
                <button class="btn-medical btn-sm" onclick="exportPatientsList()">
                  <i class="fas fa-download"></i>
                  تصدير القائمة
                </button>
                <button class="btn-medical btn-sm btn-outline" onclick="refreshPatientsList()">
                  <i class="fas fa-sync"></i>
                  تحديث
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="flex flex-col lg:flex-row gap-4 mb-6">
                <div class="search-container flex-1">
                  <input type="text" id="searchPatientInput" placeholder="بحث عن مريض..." class="form-input search-input" />
                  <i class="fas fa-search search-icon"></i>
                </div>
                <select id="filterDepartment" class="form-input form-select" style="width: 200px;">
                  <option value="all">جميع الأقسام</option>
                  <option value="emergency">الطوارئ</option>
                  <option value="icu">العناية المركزة</option>
                  <option value="operations">العمليات</option>
                  <option value="cardiology">أمراض القلب</option>
                  <option value="pediatrics">طب الأطفال</option>
                  <option value="obstetrics">أمراض النساء والتوليد</option>
                  <option value="orthopedics">العظام</option>
                  <option value="radiology">الأشعة</option>
                </select>
              </div>
              
              <div id="patientsListContainer" class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
                <!-- Patients will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Appointments Schedule Page -->
        <div id="appointments-schedulePage" class="page">
          <div class="page-header">
            <h1 class="page-title">جدولة المواعيد</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">المواعيد</span>
              <span class="breadcrumb-item">جدولة المواعيد</span>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-calendar-plus"></i>
                    حجز موعد جديد
                  </h2>
                </div>
                <div class="card-body">
                  <form id="appointmentForm" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">اختر المريض</label>
                        <select id="appointmentPatient" class="form-input form-select" required>
                          <option value="">-- اختر المريض --</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label class="form-label">اختر الطبيب</label>
                        <select id="appointmentDoctor" class="form-input form-select" required>
                          <option value="">-- اختر الطبيب --</option>
                        </select>
                      </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="form-group">
                        <label class="form-label">تاريخ الموعد</label>
                        <input type="date" id="appointmentDate" class="form-input" required />
                      </div>
                      <div class="form-group">
                        <label class="form-label">وقت الموعد</label>
                        <input type="time" id="appointmentTime" class="form-input" required />
                      </div>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">نوع الموعد</label>
                      <select id="appointmentType" class="form-input form-select" required>
                        <option value="">-- اختر النوع --</option>
                        <option value="consultation">استشارة</option>
                        <option value="followup">متابعة</option>
                        <option value="emergency">طوارئ</option>
                        <option value="surgery">عملية جراحية</option>
                        <option value="lab">فحص مختبر</option>
                        <option value="radiology">أشعة</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label class="form-label">ملاحظات</label>
                      <textarea id="appointmentNotes" rows="3" class="form-input" placeholder="أي ملاحظات إضافية"></textarea>
                    </div>
                    
                    <button type="submit" class="btn-medical w-full">
                      <i class="fas fa-calendar-check"></i>
                      حجز الموعد
                    </button>
                  </form>
                </div>
              </div>
            </div>
            
            <div class="lg:col-span-1">
              <div class="medical-card">
                <div class="card-header">
                  <h2 class="card-title">
                    <i class="fas fa-clock"></i>
                    المواعيد القادمة
                  </h2>
                </div>
                <div class="card-body">
                  <div id="upcomingAppointments" class="space-y-3">
                    <!-- Appointments will be loaded here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Medical Records Page -->
        <div id="medical-recordsPage" class="page">
          <div class="page-header">
            <h1 class="page-title">السجلات الطبية</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">السجلات الطبية</span>
              <span class="breadcrumb-item">السجلات الطبية</span>
            </div>
          </div>
          
          <div class="medical-card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-file-medical"></i>
                إدارة السجلات الطبية
              </h2>
              <button class="btn-medical btn-sm" onclick="addNewMedicalRecord()">
                <i class="fas fa-plus"></i>
                إضافة سجل جديد
              </button>
            </div>
            <div class="card-body">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                <div class="search-container">
                  <input type="text" id="searchMedicalRecord" placeholder="بحث في السجلات الطبية..." class="form-input search-input" />
                  <i class="fas fa-search search-icon"></i>
                </div>
                <select id="filterRecordType" class="form-input form-select">
                  <option value="all">جميع الأنواع</option>
                  <option value="diagnosis">تشخيص</option>
                  <option value="treatment">علاج</option>
                  <option value="surgery">جراحة</option>
                  <option value="lab">مختبر</option>
                  <option value="radiology">أشعة</option>
                </select>
              </div>
              
              <div id="medicalRecordsList" class="space-y-4">
                <!-- Medical records will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Pharmacy Inventory Page -->
        <div id="pharmacy-inventoryPage" class="page">
          <div class="page-header">
            <h1 class="page-title">مخزون الصيدلية</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">الصيدلية</span>
              <span class="breadcrumb-item">المخزون</span>
            </div>
          </div>
          
          <div class="medical-card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-pills"></i>
                إدارة الأدوية والمخزون
              </h2>
              <div class="flex gap-3">
                <button class="btn-medical btn-sm" onclick="addNewMedicine()">
                  <i class="fas fa-plus"></i>
                  إضافة دواء
                </button>
                <button class="btn-medical btn-sm btn-outline" onclick="generateInventoryReport()">
                  <i class="fas fa-file-alt"></i>
                  تقرير المخزون
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                <div class="search-container">
                  <input type="text" id="searchMedicine" placeholder="بحث عن دواء..." class="form-input search-input" />
                  <i class="fas fa-search search-icon"></i>
                </div>
                <select id="filterMedicineCategory" class="form-input form-select">
                  <option value="all">جميع الفئات</option>
                  <option value="antibiotics">مضادات حيوية</option>
                  <option value="painkillers">مسكنات</option>
                  <option value="vitamins">فيتامينات</option>
                  <option value="chronic">أمراض مزمنة</option>
                  <option value="emergency">طوارئ</option>
                </select>
                <select id="filterStockStatus" class="form-input form-select">
                  <option value="all">جميع الحالات</option>
                  <option value="instock">متوفر</option>
                  <option value="low">مخزون منخفض</option>
                  <option value="outofstock">نفد المخزون</option>
                </select>
                <button class="btn-medical btn-sm" onclick="refreshInventory()">
                  <i class="fas fa-sync"></i>
                  تحديث
                </button>
              </div>
              
              <div class="overflow-x-auto">
                <table class="medical-table">
                  <thead>
                    <tr>
                      <th>اسم الدواء</th>
                      <th>التصنيف</th>
                      <th>الكمية</th>
                      <th>السعر</th>
                      <th>تاريخ الانتهاء</th>
                      <th>الحالة</th>
                      <th>الإجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="medicinesTableBody">
                    <!-- Medicines will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Billing Invoices Page -->
        <div id="billing-invoicesPage" class="page">
          <div class="page-header">
            <h1 class="page-title">الفواتير</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">الفواتير والتأمين</span>
              <span class="breadcrumb-item">الفواتير</span>
            </div>
          </div>
          
          <div class="medical-card">
            <div class="card-header">
              <h2 class="card-title">
                <i class="fas fa-file-invoice"></i>
                إدارة الفواتير
              </h2>
              <button class="btn-medical btn-sm" onclick="createNewInvoice()">
                <i class="fas fa-plus"></i>
                إنشاء فاتورة جديدة
              </button>
            </div>
            <div class="card-body">
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                <div class="search-container">
                  <input type="text" id="searchInvoice" placeholder="بحث عن فاتورة..." class="form-input search-input" />
                  <i class="fas fa-search search-icon"></i>
                </div>
                <select id="filterInvoiceStatus" class="form-input form-select">
                  <option value="all">جميع الحالات</option>
                  <option value="paid">مدفوعة</option>
                  <option value="unpaid">غير مدفوعة</option>
                  <option value="partial">مدفوعة جزئياً</option>
                  <option value="overdue">متأخرة</option>
                </select>
                <input type="date" id="filterInvoiceDate" class="form-input" placeholder="تاريخ الفاتورة" />
              </div>
              
              <div id="invoicesList" class="space-y-4">
                <!-- Invoices will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- Reports Page -->
        <div id="reportsPage" class="page">
          <div class="page-header">
            <h1 class="page-title">التقارير</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">التقارير</span>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-chart-bar"></i>
                  تقارير المرضى
                </h2>
              </div>
              <div class="card-body space-y-3">
                <button class="btn-medical w-full btn-outline" onclick="generatePatientReport()">
                  <i class="fas fa-users"></i>
                  تقرير المرضى المسجلين
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateDepartmentReport()">
                  <i class="fas fa-hospital"></i>
                  تقرير الأقسام
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateAppointmentReport()">
                  <i class="fas fa-calendar"></i>
                  تقرير المواعيد
                </button>
              </div>
            </div>
            
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-file-medical"></i>
                  تقارير طبية
                </h2>
              </div>
              <div class="card-body space-y-3">
                <button class="btn-medical w-full btn-outline" onclick="generateMedicalReport()">
                  <i class="fas fa-notes-medical"></i>
                  تقرير السجلات الطبية
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateLabReport()">
                  <i class="fas fa-vial"></i>
                  تقرير المختبر
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generatePharmacyReport()">
                  <i class="fas fa-pills"></i>
                  تقرير الصيدلية
                </button>
              </div>
            </div>
            
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-dollar-sign"></i>
                  تقارير مالية
                </h2>
              </div>
              <div class="card-body space-y-3">
                <button class="btn-medical w-full btn-outline" onclick="generateRevenueReport()">
                  <i class="fas fa-chart-line"></i>
                  تقرير الإيرادات
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateExpenseReport()">
                  <i class="fas fa-receipt"></i>
                  تقرير المصروفات
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateBillingReport()">
                  <i class="fas fa-file-invoice-dollar"></i>
                  تقرير الفواتير
                </button>
              </div>
            </div>
            
            <div class="medical-card">
              <div class="card-header">
                <h2 class="card-title">
                  <i class="fas fa-calendar-alt"></i>
                  تقارير زمنية
                </h2>
              </div>
              <div class="card-body space-y-3">
                <button class="btn-medical w-full btn-outline" onclick="generateDailyReport()">
                  <i class="fas fa-calendar-day"></i>
                  تقرير يومي
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateWeeklyReport()">
                  <i class="fas fa-calendar-week"></i>
                  تقرير أسبوعي
                </button>
                <button class="btn-medical w-full btn-outline" onclick="generateMonthlyReport()">
                  <i class="fas fa-calendar-month"></i>
                  تقرير شهري
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loading" class="loading-overlay hidden">
    <div class="text-center">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-lg font-semibold text-gray-700">جاري تحميل البيانات...</p>
    </div>
  </div>

  <script type="module">
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyB4glqZb0hz1uvERtq0pSZZzeBy3_grAnQ",
  authDomain: "smart-life-hospital-ef64c.firebaseapp.com",
  databaseURL: "https://smart-life-hospital-ef64c-default-rtdb.firebaseio.com",
  projectId: "smart-life-hospital-ef64c",
  storageBucket: "smart-life-hospital-ef64c.firebasestorage.app",
  messagingSenderId: "851045891087",
  appId: "1:851045891087:web:8e0f6e42f8c7fed17bf77a",
  measurementId: "G-QE5BL3MTY7"
};
    
    // Initialize Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    
    // DOM Elements
    const sidebar = document.getElementById('sidebar');
    const mainContent = document.getElementById('mainContent');
    const menuToggle = document.getElementById('menuToggle');
    const userBtn = document.getElementById('userBtn');
    const userDropdown = document.getElementById('userDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    const pageContent = document.getElementById('pageContent');
    const loadingElement = document.getElementById('loading');
    const patientForm = document.getElementById('patientForm');
    const resetFormBtn = document.getElementById('resetFormBtn');
    const userName = document.getElementById('userName');
    const notificationCount = document.getElementById('notificationCount');
    
    // Global variables
    let currentUser = null;
    let charts = {};
    
    // Initialize sample data
    function initializeSampleData() {
      // Add sample doctors
      const doctorsRef = ref(db, "doctors");
      const sampleDoctors = [
        { name: "د. أحمد محمد", department: "emergency", specialization: "طب الطوارئ", phone: "01234567890", email: "ahmed@hospital.com" },
        { name: "د. فاطمة علي", department: "icu", specialization: "العناية المركزة", phone: "01234567891", email: "fatima@hospital.com" },
        { name: "د. محمد خالد", department: "operations", specialization: "جراحة عامة", phone: "01234567892", email: "mohammed@hospital.com" },
        { name: "د. نورة سعيد", department: "radiology", specialization: "الأشعة التشخيصية", phone: "01234567893", email: "nora@hospital.com" },
        { name: "د. يوسف عمر", department: "cardiology", specialization: "أمراض القلب", phone: "01234567894", email: "yousef@hospital.com" },
        { name: "د. مريم حسن", department: "pediatrics", specialization: "طب الأطفال", phone: "01234567895", email: "mariam@hospital.com" }
      ];
      
      sampleDoctors.forEach(doctor => {
        push(doctorsRef, doctor);
      });
      
      // Add sample medicines
      const medicinesRef = ref(db, "medicines");
      const sampleMedicines = [
        { name: "بنسلين", category: "antibiotics", quantity: 150, price: 25, expiryDate: "2025-12-31", status: "instock" },
        { name: "باراسيتامول", category: "painkillers", quantity: 500, price: 15, expiryDate: "2024-12-31", status: "instock" },
        { name: "فيتامين سي", category: "vitamins", quantity: 200, price: 30, expiryDate: "2025-06-30", status: "instock" },
        { name: "أموكسيسيلين", category: "antibiotics", quantity: 50, price: 35, expiryDate: "2024-08-31", status: "low" },
        { name: "إيبوبروفين", category: "painkillers", quantity: 300, price: 20, expiryDate: "2025-03-31", status: "instock" },
        { name: "ميتفورمين", category: "chronic", quantity: 100, price: 40, expiryDate: "2024-11-30", status: "instock" }
      ];
      
      sampleMedicines.forEach(medicine => {
        push(medicinesRef, medicine);
      });
      
      // Add sample departments
      const departmentsRef = ref(db, "departments");
      const sampleDepartments = [
        { name: "الطوارئ", capacity: 20, occupied: 15, head: "د. أحمد محمد", floor: 1 },
        { name: "العناية المركزة", capacity: 10, occupied: 8, head: "د. فاطمة علي", floor: 2 },
        { name: "العمليات", capacity: 5, occupied: 3, head: "د. محمد خالد", floor: 3 },
        { name: "الأشعة", capacity: 15, occupied: 10, head: "د. نورة سعيد", floor: 1 },
        { name: "أمراض القلب", capacity: 12, occupied: 9, head: "د. يوسف عمر", floor: 2 },
        { name: "طب الأطفال", capacity: 18, occupied: 12, head: "د. مريم حسن", floor: 2 }
      ];
      
      sampleDepartments.forEach(dept => {
        push(departmentsRef, dept);
      });
    }
    
    // User dropdown toggle
    userBtn.addEventListener('click', () => {
      userDropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!userBtn.contains(e.target) && !userDropdown.contains(e.target)) {
        userDropdown.classList.remove('show');
      }
    });
    
    // Sidebar toggle
    menuToggle.addEventListener('click', () => {
      sidebar.classList.toggle('show');
      mainContent.classList.toggle('expanded');
    });
    
    // Sidebar menu items
    document.querySelectorAll('.sidebar-item[data-page]').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const page = item.getAttribute('data-page');
        showPage(page);
        
        // Update active state
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Close sidebar on mobile
        if (window.innerWidth <= 1024) {
          sidebar.classList.remove('show');
        }
      });
    });
    
    // Sidebar submenu toggles
    document.querySelectorAll('.sidebar-item').forEach(item => {
      if (item.id && item.id.includes('Menu')) {
        item.addEventListener('click', () => {
          const submenuId = item.id.replace('Menu', 'Submenu');
          const submenu = document.getElementById(submenuId);
          if (submenu) {
            submenu.classList.toggle('open');
          }
        });
      }
    });
    
    // Sidebar submenu items
    document.querySelectorAll('.sidebar-submenu-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const page = item.getAttribute('data-page');
        showPage(page);
        
        // Update active state
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.sidebar-submenu-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
        
        // Close sidebar on mobile
        if (window.innerWidth <= 1024) {
          sidebar.classList.remove('show');
        }
      });
    });
    
    // Show page function
    function showPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      
      // Show the selected page
      const targetPage = document.getElementById(`${pageId}Page`);
      if (targetPage) {
        targetPage.classList.add('active');
        
        // Initialize page-specific data
        initializePageData(pageId);
      } else {
        // If page doesn't exist, show a placeholder
        const placeholder = document.createElement('div');
        placeholder.className = 'page active';
        placeholder.innerHTML = `
          <div class="page-header">
            <h1 class="page-title">${getPageTitle(pageId)}</h1>
            <div class="breadcrumb">
              <span class="breadcrumb-item">الرئيسية</span>
              <span class="breadcrumb-item">${getPageTitle(pageId)}</span>
            </div>
          </div>
          <div class="medical-card">
            <div class="card-body text-center py-12">
              <i class="fas fa-tools text-6xl text-gray-300 mb-4"></i>
              <h2 class="text-xl font-bold text-gray-700 mb-2">هذه الصفحة قيد التطوير</h2>
              <p class="text-gray-500">سيتم إضافة محتوى هذه الصفحة قريباً</p>
            </div>
          </div>
        `;
        pageContent.appendChild(placeholder);
      }
    }
    
    // Initialize page-specific data
    function initializePageData(pageId) {
      switch(pageId) {
        case 'patients-list':
          loadPatientsList();
          break;
        case 'appointments-schedule':
          loadAppointmentsData();
          break;
        case 'medical-records':
          loadMedicalRecords();
          break;
        case 'pharmacy-inventory':
          loadMedicinesInventory();
          break;
        case 'billing-invoices':
          loadInvoices();
          break;
        case 'dashboard':
          loadDashboardData();
          break;
      }
    }
    
    // Get page title
    function getPageTitle(pageId) {
      const titles = {
        'dashboard': 'لوحة التحكم',
        'patients-registration': 'تسجيل مريض جديد',
        'patients-list': 'قائمة المرضى',
        'patients-search': 'بحث متقدم',
        'appointments-schedule': 'جدولة المواعيد',
        'appointments-list': 'قائمة المواعيد',
        'appointments-calendar': 'التقويم',
        'medical-records': 'السجلات الطبية',
        'prescriptions': 'الوصفات الطبية',
        'lab-results': 'نتائج المختبر',
        'radiology': 'الأشعة',
        'rooms': 'الغرف والأسرّة',
        'departments': 'الأقسام',
        'staff': 'الموظفين',
        'doctors': 'الأطباء',
        'pharmacy-inventory': 'مخزون الصيدلية',
        'pharmacy-prescriptions': 'وصفات الصيدلية',
        'billing-invoices': 'الفواتير',
        'billing-insurance': 'التأمين الصحي',
        'billing-payments': 'المدفوعات',
        'reports': 'التقارير',
        'settings': 'الإعدادات'
      };
      return titles[pageId] || pageId;
    }
    
    // Initialize app
    function initializeApp() {
      // Check if sample data exists
      get(ref(db, "doctors")).then((snapshot) => {
        if (!snapshot.exists()) {
          initializeSampleData();
        }
      });
      
      // Load doctors
      loadDoctors();
      
      // Initialize charts
      initializeCharts();
      
      // Setup data listeners
      setupDataListeners();
      
      // Update stats
      updateStats();
      
      // Load recent activities
      loadRecentActivities();
      
      // Update notifications
      updateNotifications();
    }
    
    // Show loading overlay
    function showLoading() {
      loadingElement.classList.remove('hidden');
    }
    
    // Hide loading overlay
    function hideLoading() {
      loadingElement.classList.add('hidden');
    }
    
    // Format date for display
    function formatDate(timestamp) {
      return new Date(timestamp).toLocaleString("ar-EG", {
        year: 'numeric', month: '2-digit', day: '2-digit',
        hour: '2-digit', minute: '2-digit'
      });
    }
    
    // Load doctors from database
    function loadDoctors() {
      const doctorsRef = ref(db, "doctors");
      
      onValue(doctorsRef, (snapshot) => {
        const doctors = snapshot.val() || {};
        
        // Update doctor selects
        const doctorSelects = document.querySelectorAll('#doctorSelect, #appointmentDoctor');
        doctorSelects.forEach(select => {
          if (select) {
            select.innerHTML = '<option value="">-- اختر الطبيب --</option>';
            
            Object.entries(doctors).forEach(([id, doctor]) => {
              const option = document.createElement("option");
              option.value = id;
              option.textContent = `${doctor.name} - ${getDepartmentName(doctor.department)}`;
              select.appendChild(option);
            });
          }
        });
      });
    }
    
    // Get department name
    function getDepartmentName(department) {
      const departments = {
        emergency: 'الطوارئ',
        icu: 'العناية المركزة',
        surgery: 'العمليات',
        care: 'الرعاية',
        admin: 'الإدارة',
        radiology: 'الأشعة',
        operations: 'العمليات',
        cardiology: 'أمراض القلب',
        pediatrics: 'طب الأطفال',
        obstetrics: 'أمراض النساء والتوليد',
        orthopedics: 'العظام'
      };
      return departments[department] || department;
    }
    
    // Form submission for patient registration
    patientForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const selectedDoctor = document.getElementById("doctorSelect").value;
      let doctorName = '';
      
      if (selectedDoctor) {
        const selectedOption = doctorSelect.options[doctorSelect.selectedIndex];
        doctorName = selectedOption.textContent.split(' - ')[0];
      }
      
      const birthDate = new Date(document.getElementById("birthDate").value);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      const formData = {
        name: document.getElementById("name").value.trim(),
        nid: document.getElementById("nid").value.trim(),
        birthDate: document.getElementById("birthDate").value,
        age: age,
        gender: document.getElementById("gender").value,
        bloodType: document.getElementById("bloodType").value,
        phone: document.getElementById("phone").value.trim(),
        email: document.getElementById("email").value.trim(),
        address: document.getElementById("address").value.trim(),
        diseases: document.getElementById("diseases").value.trim(),
        department: document.getElementById("department").value,
        doctorId: selectedDoctor,
        doctorName: doctorName,
        insuranceCompany: document.getElementById("insuranceCompany").value.trim(),
        insuranceNumber: document.getElementById("insuranceNumber").value.trim(),
        timestamp: new Date().toISOString()
      };
      
      if (!formData.name || !formData.nid || !formData.birthDate || !formData.gender || 
          !formData.bloodType || !formData.phone || !formData.address || !formData.department) {
        Swal.fire({
          icon: 'warning',
          title: 'بيانات ناقصة',
          text: 'يرجى ملء جميع الحقول الإلزامية',
          confirmButtonText: 'حسناً'
        });
        return;
      }
      
      try {
        showLoading();
        const patientsRef = ref(db, `patients/${formData.department}`);
        const newPatientRef = await push(patientsRef, formData);
        
        // Add activity log
        await addActivityLog('patient_registered', `تم تسجيل مريض جديد: ${formData.name}`, newPatientRef.key);
        
        Swal.fire({
          icon: 'success',
          title: 'تم التسجيل بنجاح',
          text: `تم تسجيل المريض ${formData.name}`,
          timer: 2000,
          showConfirmButton: false,
          position: 'top-end',
          toast: true
        });
        
        patientForm.reset();
        hideLoading();
      } catch (error) {
        hideLoading();
        Swal.fire({
          icon: 'error',
          title: 'خطأ',
          text: 'حدث خطأ أثناء التسجيل'
        });
      }
    });
    
    // Reset form button
    resetFormBtn.addEventListener('click', () => {
      patientForm.reset();
    });
    
    // Load patients list
    function loadPatientsList() {
      const patientsListContainer = document.getElementById('patientsListContainer');
      if (!patientsListContainer) return;
      
      patientsListContainer.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-3xl text-blue-500"></i></div>';
      
      const patientsRef = ref(db, "patients");
      onValue(patientsRef, (snapshot) => {
        const data = snapshot.val() || {};
        let allPatients = [];
        
        Object.entries(data).forEach(([dept, patients]) => {
          Object.entries(patients).forEach(([id, patient]) => {
            allPatients.push({ ...patient, id, department: dept });
          });
        });
        
        if (allPatients.length === 0) {
          patientsListContainer.innerHTML = `
            <div class="text-center py-12">
              <i class="fas fa-user-slash text-6xl text-gray-300 mb-4"></i>
              <p class="text-gray-500 text-lg">لا يوجد مرضى مسجلين</p>
              <p class="text-gray-400 text-sm mt-2">قم بتسجيل أول مريض للبدء</p>
            </div>
          `;
          return;
        }
        
        // Sort by timestamp (newest first)
        allPatients.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        patientsListContainer.innerHTML = allPatients.map(patient => createPatientCard(patient)).join('');
      });
    }
    
    // Create patient card
    function createPatientCard(patient) {
      const genderText = patient.gender === 'male' ? 'ذكر' : 'أنثى';
      const genderIcon = patient.gender === 'male' ? 'fa-mars' : 'fa-venus';
      const deptClass = `dept-${patient.department}`;
      
      return `
        <div class="patient-card">
          <div class="flex items-start gap-4">
            <div class="patient-avatar">
              ${patient.name.charAt(0).toUpperCase()}
            </div>
            <div class="patient-info flex-1">
              <div class="flex items-center justify-between mb-2">
                <h3 class="patient-name">${patient.name}</h3>
                <span class="dept-badge ${deptClass}">
                  ${getDepartmentIcon(patient.department)}
                  ${getDepartmentName(patient.department)}
                </span>
              </div>
              
              <div class="patient-details">
                <div class="detail-item">
                  <i class="fas fa-id-card"></i>
                  <span>${patient.nid}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-${genderIcon}"></i>
                  <span>${genderText}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-birthday-cake"></i>
                  <span>${patient.age} سنة</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-tint"></i>
                  <span>${patient.bloodType}</span>
                </div>
                <div class="detail-item">
                  <i class="fas fa-phone"></i>
                  <span>${patient.phone}</span>
                </div>
              </div>
              
              ${patient.doctorName ? `
              <div class="detail-item mt-2">
                <i class="fas fa-user-md"></i>
                <span>الطبيب: ${patient.doctorName}</span>
              </div>
              ` : ''}
              
              ${patient.diseases ? `
              <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                <div class="detail-item mb-1">
                  <i class="fas fa-notes-medical"></i>
                  <span class="font-semibold">ملاحظات طبية:</span>
                </div>
                <p class="text-sm text-gray-600 pr-6">${patient.diseases}</p>
              </div>
              ` : ''}
              
              <div class="flex items-center justify-between mt-3">
                <div class="detail-item text-xs">
                  <i class="fas fa-clock"></i>
                  <span>${formatDate(patient.timestamp)}</span>
                </div>
                <div class="flex gap-2">
                  <button class="action-btn btn-edit" onclick="editPatient('${patient.id}', '${patient.department}')">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="action-btn btn-delete" onclick="deletePatient('${patient.id}', '${patient.department}')">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // Get department icon
    function getDepartmentIcon(department) {
      const icons = {
        emergency: '<i class="fas fa-ambulance"></i>',
        icu: '<i class="fas fa-procedures"></i>',
        surgery: '<i class="fas fa-user-md"></i>',
        care: '<i class="fas fa-hand-holding-heart"></i>',
        admin: '<i class="fas fa-building"></i>',
        radiology: '<i class="fas fa-x-ray"></i>',
        operations: '<i class="fas fa-user-md"></i>',
        cardiology: '<i class="fas fa-heartbeat"></i>',
        pediatrics: '<i class="fas fa-baby"></i>',
        obstetrics: '<i class="fas fa-female"></i>',
        orthopedics: '<i class="fas fa-bone"></i>'
      };
      return icons[department] || '<i class="fas fa-hospital"></i>';
    }
    
    // Edit patient
    window.editPatient = function(id, department) {
      const patientRef = ref(db, `patients/${department}/${id}`);
      
      get(patientRef).then((snapshot) => {
        const patient = snapshot.val();
        if (!patient) return;
        
        Swal.fire({
          title: 'تعديل بيانات المريض',
          html: `
            <form id="editPatientForm" class="text-right">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium mb-1">الاسم</label>
                  <input type="text" id="editName" value="${patient.name}" class="w-full p-2 border rounded" required />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">الرقم القومي</label>
                  <input type="text" id="editNid" value="${patient.nid}" class="w-full p-2 border rounded" required />
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label class="block text-sm font-medium mb-1">الهاتف</label>
                  <input type="tel" id="editPhone" value="${patient.phone}" class="w-full p-2 border rounded" required />
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">البريد الإلكتروني</label>
                  <input type="email" id="editEmail" value="${patient.email || ''}" class="w-full p-2 border rounded" />
                </div>
              </div>
              <div class="mb-4">
                <label class="block text-sm font-medium mb-1">العنوان</label>
                <input type="text" id="editAddress" value="${patient.address}" class="w-full p-2 border rounded" required />
              </div>
              <div class="mb-4">
                <label class="block text-sm font-medium mb-1">ملاحظات طبية</label>
                <textarea id="editDiseases" rows="3" class="w-full p-2 border rounded">${patient.diseases || ''}</textarea>
              </div>
            </form>
          `,
          showCancelButton: true,
          confirmButtonText: 'حفظ التعديلات',
          cancelButtonText: 'إلغاء',
          preConfirm: () => {
            return {
              name: document.getElementById('editName').value,
              nid: document.getElementById('editNid').value,
              phone: document.getElementById('editPhone').value,
              email: document.getElementById('editEmail').value,
              address: document.getElementById('editAddress').value,
              diseases: document.getElementById('editDiseases').value
            };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            const updatedData = result.value;
            update(patientRef, updatedData).then(() => {
              Swal.fire('نجح!', 'تم تحديث بيانات المريض', 'success');
              addActivityLog('patient_updated', `تم تحديث بيانات المريض: ${updatedData.name}`, id);
            });
          }
        });
      });
    }
    
    // Delete patient
    window.deletePatient = function(id, department) {
      Swal.fire({
        title: 'تأكيد الحذف',
        text: "هل أنت متأكد من حذف بيانات هذا المريض؟",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#FF6B6B',
        cancelButtonColor: '#6C757D',
        confirmButtonText: 'نعم، احذف',
        cancelButtonText: 'إلغاء'
      }).then((result) => {
        if (result.isConfirmed) {
          const patientRef = ref(db, `patients/${department}/${id}`);
          
          get(patientRef).then((snapshot) => {
            const patient = snapshot.val();
            remove(patientRef).then(() => {
              Swal.fire('تم الحذف!', 'تم حذف بيانات المريض', 'success');
              addActivityLog('patient_deleted', `تم حذف المريض: ${patient.name}`, id);
            });
          });
        }
      });
    }
    
    // Load appointments data
    function loadAppointmentsData() {
      // Load patients for appointment form
      const appointmentPatient = document.getElementById('appointmentPatient');
      if (appointmentPatient) {
        const patientsRef = ref(db, "patients");
        onValue(patientsRef, (snapshot) => {
          const data = snapshot.val() || {};
          appointmentPatient.innerHTML = '<option value="">-- اختر المريض --</option>';
          
          Object.entries(data).forEach(([dept, patients]) => {
            Object.entries(patients).forEach(([id, patient]) => {
              const option = document.createElement("option");
              option.value = id;
              option.textContent = `${patient.name} - ${getDepartmentName(dept)}`;
              appointmentPatient.appendChild(option);
            });
          });
        });
      }
      
      // Load upcoming appointments
      loadUpcomingAppointments();
    }
    
    // Load upcoming appointments
    function loadUpcomingAppointments() {
      const upcomingAppointments = document.getElementById('upcomingAppointments');
      if (!upcomingAppointments) return;
      
      const appointmentsRef = ref(db, "appointments");
      onValue(appointmentsRef, (snapshot) => {
        const appointments = snapshot.val() || {};
        const today = new Date();
        let upcoming = [];
        
        Object.entries(appointments).forEach(([id, appointment]) => {
          const appointmentDate = new Date(`${appointment.date} ${appointment.time}`);
          if (appointmentDate >= today) {
            upcoming.push({ ...appointment, id });
          }
        });
        
        // Sort by date
        upcoming.sort((a, b) => new Date(`${a.date} ${a.time}`) - new Date(`${b.date} ${b.time}`));
        
        if (upcoming.length === 0) {
          upcomingAppointments.innerHTML = '<p class="text-gray-500 text-center">لا توجد مواعد قادمة</p>';
          return;
        }
        
        upcomingAppointments.innerHTML = upcoming.slice(0, 5).map(appointment => `
          <div class="p-3 bg-gray-50 rounded-lg">
            <div class="flex justify-between items-start">
              <div>
                <p class="font-semibold">${appointment.patientName}</p>
                <p class="text-sm text-gray-600">${appointment.doctorName}</p>
                <p class="text-xs text-gray-500">${formatDate(appointment.timestamp)}</p>
              </div>
              <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded">
                ${appointment.type}
              </span>
            </div>
          </div>
        `).join('');
      });
    }
    
    // Appointment form submission
    const appointmentForm = document.getElementById('appointmentForm');
    if (appointmentForm) {
      appointmentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const appointmentPatient = document.getElementById('appointmentPatient');
        const appointmentDoctor = document.getElementById('appointmentDoctor');
        const selectedPatientOption = appointmentPatient.options[appointmentPatient.selectedIndex];
        const selectedDoctorOption = appointmentDoctor.options[appointmentDoctor.selectedIndex];
        
        const appointmentData = {
          patientId: appointmentPatient.value,
          patientName: selectedPatientOption.textContent.split(' - ')[0],
          doctorId: appointmentDoctor.value,
          doctorName: selectedDoctorOption.textContent.split(' - ')[0],
          date: document.getElementById('appointmentDate').value,
          time: document.getElementById('appointmentTime').value,
          type: document.getElementById('appointmentType').value,
          notes: document.getElementById('appointmentNotes').value,
          status: 'scheduled',
          timestamp: new Date().toISOString()
        };
        
        try {
          showLoading();
          const appointmentsRef = ref(db, "appointments");
          const newAppointmentRef = await push(appointmentsRef, appointmentData);
          
          await addActivityLog('appointment_scheduled', `تم حجز موعد: ${appointmentData.patientName} مع ${appointmentData.doctorName}`, newAppointmentRef.key);
          
          Swal.fire({
            icon: 'success',
            title: 'تم حجز الموعد',
            text: `تم حجز الموعد بنجاح`,
            timer: 2000,
            showConfirmButton: false,
            position: 'top-end',
            toast: true
          });
          
          appointmentForm.reset();
          hideLoading();
        } catch (error) {
          hideLoading();
          Swal.fire({
            icon: 'error',
            title: 'خطأ',
            text: 'حدث خطأ أثناء حجز الموعد'
          });
        }
      });
    }
    
    // Load medical records
    function loadMedicalRecords() {
      const medicalRecordsList = document.getElementById('medicalRecordsList');
      if (!medicalRecordsList) return;
      
      medicalRecordsList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-3xl text-blue-500"></i></div>';
      
      const recordsRef = ref(db, "medicalRecords");
      onValue(recordsRef, (snapshot) => {
        const records = snapshot.val() || {};
        
        if (Object.keys(records).length === 0) {
          medicalRecordsList.innerHTML = `
            <div class="text-center py-12">
              <i class="fas fa-file-medical text-6xl text-gray-300 mb-4"></i>
              <p class="text-gray-500 text-lg">لا توجد سجلات طبية</p>
            </div>
          `;
          return;
        }
        
        medicalRecordsList.innerHTML = Object.entries(records).map(([id, record]) => `
          <div class="medical-card">
            <div class="card-header">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-semibold">${record.patientName}</h3>
                  <p class="text-sm text-gray-600">${record.doctorName} - ${formatDate(record.timestamp)}</p>
                </div>
                <span class="dept-badge dept-${record.department}">
                  ${getDepartmentIcon(record.department)}
                  ${getDepartmentName(record.department)}
                </span>
              </div>
            </div>
            <div class="card-body">
              <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="text-sm font-semibold">التشخيص:</p>
                  <p class="text-sm">${record.diagnosis}</p>
                </div>
                <div>
                  <p class="text-sm font-semibold">العلاج:</p>
                  <p class="text-sm">${record.treatment}</p>
                </div>
              </div>
              ${record.notes ? `
              <div>
                <p class="text-sm font-semibold">ملاحظات:</p>
                <p class="text-sm">${record.notes}</p>
              </div>
              ` : ''}
              <div class="flex gap-2 mt-4">
                <button class="btn-medical btn-sm btn-outline" onclick="viewMedicalRecord('${id}')">
                  <i class="fas fa-eye"></i>
                  عرض
                </button>
                <button class="btn-medical btn-sm btn-outline" onclick="printMedicalRecord('${id}')">
                  <i class="fas fa-print"></i>
                  طباعة
                </button>
              </div>
            </div>
          </div>
        `).join('');
      });
    }
    
    // Load medicines inventory
    function loadMedicinesInventory() {
      const medicinesTableBody = document.getElementById('medicinesTableBody');
      if (!medicinesTableBody) return;
      
      medicinesTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-8"><i class="fas fa-spinner fa-spin text-3xl text-blue-500"></i></td></tr>';
      
      const medicinesRef = ref(db, "medicines");
      onValue(medicinesRef, (snapshot) => {
        const medicines = snapshot.val() || {};
        
        if (Object.keys(medicines).length === 0) {
          medicinesTableBody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">لا توجد أدوية في المخزون</td></tr>';
          return;
        }
        
        medicinesTableBody.innerHTML = Object.entries(medicines).map(([id, medicine]) => {
          const statusClass = medicine.status === 'instock' ? 'text-green-600' : 
                              medicine.status === 'low' ? 'text-yellow-600' : 'text-red-600';
          const statusText = medicine.status === 'instock' ? 'متوفر' : 
                            medicine.status === 'low' ? 'مخزون منخفض' : 'نفد المخزون';
          
          return `
            <tr>
              <td class="font-semibold">${medicine.name}</td>
              <td>${getCategoryName(medicine.category)}</td>
              <td>${medicine.quantity}</td>
              <td>${medicine.price} ج.م</td>
              <td>${medicine.expiryDate}</td>
              <td class="${statusClass}">${statusText}</td>
              <td>
                <div class="flex gap-2">
                  <button class="action-btn btn-edit" onclick="editMedicine('${id}')">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="action-btn btn-delete" onclick="deleteMedicine('${id}')">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        }).join('');
      });
    }
    
    // Get category name
    function getCategoryName(category) {
      const categories = {
        antibiotics: 'مضادات حيوية',
        painkillers: 'مسكنات',
        vitamins: 'فيتامينات',
        chronic: 'أمراض مزمنة',
        emergency: 'طوارئ'
      };
      return categories[category] || category;
    }
    
    // Load invoices
    function loadInvoices() {
      const invoicesList = document.getElementById('invoicesList');
      if (!invoicesList) return;
      
      invoicesList.innerHTML = '<div class="text-center py-8"><i class="fas fa-spinner fa-spin text-3xl text-blue-500"></i></div>';
      
      const invoicesRef = ref(db, "invoices");
      onValue(invoicesRef, (snapshot) => {
        const invoices = snapshot.val() || {};
        
        if (Object.keys(invoices).length === 0) {
          invoicesList.innerHTML = `
            <div class="text-center py-12">
              <i class="fas fa-file-invoice text-6xl text-gray-300 mb-4"></i>
              <p class="text-gray-500 text-lg">لا توجد فواتير</p>
            </div>
          `;
          return;
        }
        
        invoicesList.innerHTML = Object.entries(invoices).map(([id, invoice]) => {
          const statusClass = invoice.status === 'paid' ? 'text-green-600' : 
                              invoice.status === 'unpaid' ? 'text-red-600' : 'text-yellow-600';
          const statusText = invoice.status === 'paid' ? 'مدفوعة' : 
                            invoice.status === 'unpaid' ? 'غير مدفوعة' : 'مدفوعة جزئياً';
          
          return `
            <div class="medical-card">
              <div class="card-header">
                <div class="flex justify-between items-center">
                  <div>
                    <h3 class="font-semibold">فاتورة رقم: ${id.slice(-6)}</h3>
                    <p class="text-sm text-gray-600">${invoice.patientName} - ${formatDate(invoice.timestamp)}</p>
                  </div>
                  <span class="${statusClass} font-semibold">${statusText}</span>
                </div>
              </div>
              <div class="card-body">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                  <div>
                    <p class="text-sm text-gray-600">المبلغ الإجمالي</p>
                    <p class="font-semibold">${invoice.totalAmount} ج.م</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-600">المبلغ المدفوع</p>
                    <p class="font-semibold">${invoice.paidAmount || 0} ج.م</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-600">المتبقي</p>
                    <p class="font-semibold">${(invoice.totalAmount - (invoice.paidAmount || 0))} ج.م</p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-600">طريقة الدفع</p>
                    <p class="font-semibold">${invoice.paymentMethod || 'نقدي'}</p>
                  </div>
                </div>
                <div class="flex gap-2">
                  <button class="btn-medical btn-sm btn-outline" onclick="viewInvoice('${id}')">
                    <i class="fas fa-eye"></i>
                    عرض
                  </button>
                  <button class="btn-medical btn-sm btn-outline" onclick="printInvoice('${id}')">
                    <i class="fas fa-print"></i>
                    طباعة
                  </button>
                  ${invoice.status !== 'paid' ? `
                  <button class="btn-medical btn-sm" onclick="payInvoice('${id}')">
                    <i class="fas fa-credit-card"></i>
                    دفع
                  </button>
                  ` : ''}
                </div>
              </div>
            </div>
          `;
        }).join('');
      });
    }
    
    // Update statistics
    function updateStats() {
      const todayDate = new Date().toDateString();
      let total = 0, today = 0, emergency = 0, surgery = 0;
      
      onValue(ref(db, "patients"), (snapshot) => {
        const data = snapshot.val() || {};
        
        Object.values(data).forEach(dept => {
          Object.values(dept).forEach(patient => {
            total++;
            if (new Date(patient.timestamp).toDateString() === todayDate) today++;
            if (patient.department === 'emergency') emergency++;
            if (patient.department === 'surgery' || patient.department === 'operations') surgery++;
          });
        });
        
        const totalPatientsElement = document.getElementById('totalPatients');
        const todayPatientsElement = document.getElementById('todayPatients');
        const emergencyPatientsElement = document.getElementById('emergencyPatients');
        const surgeryPatientsElement = document.getElementById('surgeryPatients');
        
        if (totalPatientsElement) totalPatientsElement.textContent = total;
        if (todayPatientsElement) todayPatientsElement.textContent = today;
        if (emergencyPatientsElement) emergencyPatientsElement.textContent = emergency;
        if (surgeryPatientsElement) surgeryPatientsElement.textContent = surgery;
      });
    }
    
    // Initialize charts
    function initializeCharts() {
      // Department distribution chart
      const deptCtx = document.getElementById('departmentChart');
      if (deptCtx) {
        charts.department = new Chart(deptCtx.getContext('2d'), {
          type: 'bar',
          data: {
            labels: ['الطوارئ', 'العناية المركزة', 'العمليات', 'الرعاية', 'الإدارة', 'الأشعة'],
            datasets: [{
              label: 'عدد المرضى',
              data: [0, 0, 0, 0, 0, 0],
              backgroundColor: [
                'rgba(255, 107, 107, 0.7)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(0, 102, 204, 0.7)',
                'rgba(107, 207, 127, 0.7)',
                'rgba(108, 117, 125, 0.7)',
                'rgba(14, 165, 233, 0.7)'
              ],
              borderColor: [
                'rgb(255, 107, 107)',
                'rgb(139, 92, 246)',
                'rgb(0, 102, 204)',
                'rgb(107, 207, 127)',
                'rgb(108, 117, 125)',
                'rgb(14, 165, 233)'
              ],
              borderWidth: 1,
              borderRadius: 8
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                },
                grid: {
                  borderDash: [5, 5]
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const deptCounts = [0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const deptIndex = getDepartmentIndex(patient.department);
              if (deptIndex !== -1) deptCounts[deptIndex]++;
            });
          });
          
          charts.department.data.datasets[0].data = deptCounts;
          charts.department.update();
        });
      }
      
      // Daily patients chart
      const dailyCtx = document.getElementById('dailyChart');
      if (dailyCtx) {
        charts.daily = new Chart(dailyCtx.getContext('2d'), {
          type: 'line',
          data: {
            labels: ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'],
            datasets: [{
              label: 'عدد المرضى',
              data: [0, 0, 0, 0, 0, 0, 0],
              fill: true,
              backgroundColor: 'rgba(0, 102, 204, 0.1)',
              borderColor: 'rgb(0, 102, 204)',
              tension: 0.4,
              pointBackgroundColor: 'rgb(0, 102, 204)',
              pointBorderColor: '#fff',
              pointBorderWidth: 2,
              pointRadius: 4,
              pointHoverRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                },
                grid: {
                  borderDash: [5, 5]
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const dailyCounts = [0, 0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const patientDate = new Date(patient.timestamp);
              const patientDay = patientDate.getDay();
              if (patientDay >= 0 && patientDay <= 6) {
                dailyCounts[patientDay]++;
              }
            });
          });
          
          charts.daily.data.datasets[0].data = dailyCounts;
          charts.daily.update();
        });
      }
      
      // Blood type distribution chart
      const bloodCtx = document.getElementById('bloodTypeChart');
      if (bloodCtx) {
        charts.blood = new Chart(bloodCtx.getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'],
            datasets: [{
              label: 'فصيلة الدم',
              data: [0, 0, 0, 0, 0, 0, 0, 0],
              backgroundColor: [
                'rgba(255, 107, 107, 0.7)',
                'rgba(255, 107, 107, 0.5)',
                'rgba(0, 102, 204, 0.7)',
                'rgba(0, 102, 204, 0.5)',
                'rgba(139, 92, 246, 0.7)',
                'rgba(139, 92, 246, 0.5)',
                'rgba(107, 207, 127, 0.7)',
                'rgba(107, 207, 127, 0.5)'
              ],
              borderColor: '#fff',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'right',
                labels: {
                  padding: 15,
                  font: {
                    size: 12
                  }
                }
              }
            }
          }
        });
        
        // Update chart with real data
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          const bloodCounts = [0, 0, 0, 0, 0, 0, 0, 0];
          
          Object.values(data).forEach(dept => {
            Object.values(dept).forEach(patient => {
              const bloodIndex = getBloodTypeIndex(patient.bloodType);
              if (bloodIndex !== -1) bloodCounts[bloodIndex]++;
            });
          });
          
          charts.blood.data.datasets[0].data = bloodCounts;
          charts.blood.update();
        });
      }
    }
    
    // Helper functions
    function getDepartmentIndex(department) {
      const departments = ['emergency', 'icu', 'surgery', 'care', 'admin', 'radiology'];
      return departments.indexOf(department);
    }
    
    function getBloodTypeIndex(bloodType) {
      const bloodTypes = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
      return bloodTypes.indexOf(bloodType);
    }
    
    // Load recent activities
    function loadRecentActivities() {
      const recentActivities = document.getElementById('recentActivities');
      if (!recentActivities) return;
      
      const activitiesRef = ref(db, "activities");
      onValue(activitiesRef, (snapshot) => {
        const activities = snapshot.val() || {};
        const activitiesArray = Object.entries(activities).map(([id, activity]) => ({
          id,
          ...activity
        }));
        
        // Sort by timestamp (newest first)
        activitiesArray.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        if (activitiesArray.length === 0) {
          recentActivities.innerHTML = '<p class="text-gray-500 text-center">لا توجد نشاطات حديثة</p>';
          return;
        }
        
        recentActivities.innerHTML = activitiesArray.slice(0, 5).map(activity => {
          const icon = getActivityIcon(activity.type);
          const color = getActivityColor(activity.type);
          
          return `
            <div class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
              <div class="w-10 h-10 rounded-full ${color} flex items-center justify-center text-white">
                <i class="fas ${icon}"></i>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium">${activity.description}</p>
                <p class="text-xs text-gray-500">${formatDate(activity.timestamp)}</p>
              </div>
            </div>
          `;
        }).join('');
      });
    }
    
    // Get activity icon
    function getActivityIcon(type) {
      const icons = {
        patient_registered: 'fa-user-plus',
        patient_updated: 'fa-user-edit',
        patient_deleted: 'fa-user-times',
        appointment_scheduled: 'fa-calendar-check',
        appointment_completed: 'fa-calendar-check',
        medical_record_added: 'fa-file-medical',
        medicine_added: 'fa-pills',
        invoice_created: 'fa-file-invoice',
        invoice_paid: 'fa-credit-card'
      };
      return icons[type] || 'fa-info-circle';
    }
    
    // Get activity color
    function getActivityColor(type) {
      const colors = {
        patient_registered: 'bg-blue-100 text-blue-600',
        patient_updated: 'bg-yellow-100 text-yellow-600',
        patient_deleted: 'bg-red-100 text-red-600',
        appointment_scheduled: 'bg-purple-100 text-purple-600',
        appointment_completed: 'bg-green-100 text-green-600',
        medical_record_added: 'bg-indigo-100 text-indigo-600',
        medicine_added: 'bg-pink-100 text-pink-600',
        invoice_created: 'bg-orange-100 text-orange-600',
        invoice_paid: 'bg-green-100 text-green-600'
      };
      return colors[type] || 'bg-gray-100 text-gray-600';
    }
    
    // Add activity log
    async function addActivityLog(type, description, relatedId = null) {
      const activity = {
        type,
        description,
        relatedId,
        timestamp: new Date().toISOString(),
        userId: currentUser?.id || 'system'
      };
      
      const activitiesRef = ref(db, "activities");
      await push(activitiesRef, activity);
    }
    
    // Update notifications
    function updateNotifications() {
      const appointmentsRef = ref(db, "appointments");
      onValue(appointmentsRef, (snapshot) => {
        const appointments = snapshot.val() || {};
        const today = new Date().toDateString();
        let todayCount = 0;
        
        Object.values(appointments).forEach(appointment => {
          if (new Date(appointment.date).toDateString() === today) {
            todayCount++;
          }
        });
        
        if (notificationCount) {
          notificationCount.textContent = todayCount;
        }
      });
    }
    
    // Load dashboard data
    function loadDashboardData() {
      updateStats();
      loadRecentActivities();
    }
    
    // Setup data listeners
    function setupDataListeners() {
      // Search functionality
      const searchPatientInput = document.getElementById('searchPatientInput');
      if (searchPatientInput) {
        searchPatientInput.addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          const patientCards = document.querySelectorAll('.patient-card');
          
          patientCards.forEach(card => {
            const text = card.textContent.toLowerCase();
            card.style.display = text.includes(searchTerm) ? 'block' : 'none';
          });
        });
      }
      
      // Filter functionality
      const filterDepartment = document.getElementById('filterDepartment');
      if (filterDepartment) {
        filterDepartment.addEventListener('change', (e) => {
          const filterValue = e.target.value;
          const patientCards = document.querySelectorAll('.patient-card');
          
          patientCards.forEach(card => {
            if (filterValue === 'all') {
              card.style.display = 'block';
            } else {
              const deptBadge = card.querySelector('.dept-badge');
              if (deptBadge && deptBadge.textContent.includes(getDepartmentName(filterValue))) {
                card.style.display = 'block';
              } else {
                card.style.display = 'none';
              }
            }
          });
        });
      }
    }
    
    // Global functions for buttons
    window.capturePatientPhoto = function() {
      Swal.fire({
        icon: 'info',
        title: 'التقاط صورة',
        text: 'سيتم إضافة ميزة الكاميرا قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.uploadMedicalDocuments = function() {
      Swal.fire({
        icon: 'info',
        title: 'رفع المستندات',
        text: 'سيتم إضافة ميزة رفع الملفات قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generatePatientQR = function() {
      Swal.fire({
        icon: 'info',
        title: 'رمز QR',
        text: 'سيتم إضافة ميزة إنشاء رمز QR قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.viewAllActivities = function() {
      showPage('reports');
    }
    
    window.exportPatientsList = function() {
      Swal.fire({
        icon: 'success',
        title: 'تصدير القائمة',
        text: 'سيتم تصدير قائمة المرضى قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.refreshPatientsList = function() {
      loadPatientsList();
      Swal.fire({
        icon: 'success',
        title: 'تم التحديث',
        timer: 1000,
        showConfirmButton: false
      });
    }
    
    window.addNewMedicalRecord = function() {
      Swal.fire({
        icon: 'info',
        title: 'إضافة سجل طبي',
        text: 'سيتم إضافة نموذج السجل الطبي قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.addNewMedicine = function() {
      Swal.fire({
        icon: 'info',
        title: 'إضافة دواء',
        text: 'سيتم إضافة نموذج الدواء قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateInventoryReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير المخزون',
        text: 'سيتم إنشاء تقرير المخزون قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.refreshInventory = function() {
      loadMedicinesInventory();
      Swal.fire({
        icon: 'success',
        title: 'تم التحديث',
        timer: 1000,
        showConfirmButton: false
      });
    }
    
    window.createNewInvoice = function() {
      Swal.fire({
        icon: 'info',
        title: 'إنشاء فاتورة',
        text: 'سيتم إضافة نموذج الفاتورة قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.viewMedicalRecord = function(id) {
      Swal.fire({
        icon: 'info',
        title: 'عرض السجل الطبي',
        text: 'سيتم عرض تفاصيل السجل الطبي قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.printMedicalRecord = function(id) {
      window.print();
    }
    
    window.editMedicine = function(id) {
      Swal.fire({
        icon: 'info',
        title: 'تعديل الدواء',
        text: 'سيتم إضافة نموذج التعديل قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.deleteMedicine = function(id) {
      Swal.fire({
        title: 'تأكيد الحذف',
        text: "هل أنت متأكد من حذف هذا الدواء؟",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#FF6B6B',
        cancelButtonColor: '#6C757D',
        confirmButtonText: 'نعم، احذف',
        cancelButtonText: 'إلغاء'
      }).then((result) => {
        if (result.isConfirmed) {
          const medicineRef = ref(db, `medicines/${id}`);
          remove(medicineRef).then(() => {
            Swal.fire('تم الحذف!', 'تم حذف الدواء', 'success');
          });
        }
      });
    }
    
    window.viewInvoice = function(id) {
      Swal.fire({
        icon: 'info',
        title: 'عرض الفاتورة',
        text: 'سيتم عرض تفاصيل الفاتورة قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.printInvoice = function(id) {
      window.print();
    }
    
    window.payInvoice = function(id) {
      Swal.fire({
        icon: 'info',
        title: 'دفع الفاتورة',
        text: 'سيتم إضافة صفحة الدفع قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    // Report generation functions
    window.generatePatientReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير المرضى',
        text: 'سيتم إنشاء تقرير المرضى قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateDepartmentReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير الأقسام',
        text: 'سيتم إنشاء تقرير الأقسام قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateAppointmentReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير المواعيد',
        text: 'سيتم إنشاء تقرير المواعيد قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateMedicalReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير السجلات الطبية',
        text: 'سيتم إنشاء تقرير السجلات الطبية قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateLabReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير المختبر',
        text: 'سيتم إنشاء تقرير المختبر قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generatePharmacyReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير الصيدلية',
        text: 'سيتم إنشاء تقرير الصيدلية قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateRevenueReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير الإيرادات',
        text: 'سيتم إنشاء تقرير الإيرادات قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateExpenseReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير المصروفات',
        text: 'سيتم إنشاء تقرير المصروفات قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateBillingReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير الفواتير',
        text: 'سيتم إنشاء تقرير الفواتير قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateDailyReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير يومي',
        text: 'سيتم إنشاء التقرير اليومي قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateWeeklyReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير أسبوعي',
        text: 'سيتم إنشاء التقرير الأسبوعي قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    window.generateMonthlyReport = function() {
      Swal.fire({
        icon: 'info',
        title: 'تقرير شهري',
        text: 'سيتم إنشاء التقرير الشهري قريباً',
        confirmButtonText: 'حسناً'
      });
    }
    
    // Print report function
    const printReportBtn = document.getElementById('printReportBtn');
    if (printReportBtn) {
      printReportBtn.addEventListener('click', () => {
        window.print();
      });
    }
    
    // Export PDF function
    const exportPdfBtn = document.getElementById('exportPdfBtn');
    if (exportPdfBtn) {
      exportPdfBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFont('Cairo', 'normal');
        doc.setFontSize(18);
        doc.text('تقرير المرضى - مستشفى الحياة الذكية', 105, 15, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text(`التاريخ: ${new Date().toLocaleDateString("ar-EG")}`, 105, 25, { align: 'center' });
        
        doc.setFontSize(14);
        doc.text('قائمة المرضى', 20, 40);
        
        doc.setFontSize(10);
        let y = 50;
        
        onValue(ref(db, "patients"), (snapshot) => {
          const data = snapshot.val() || {};
          let patientCount = 0;
          
          Object.entries(data).forEach(([dept, patients]) => {
            Object.entries(patients).forEach(([id, patient]) => {
              if (patientCount > 0) y += 10;
              doc.text(`${patientCount + 1}. ${patient.name} - ${dept}`, 20, y);
              doc.text(`   العمر: ${patient.age} | الجنس: ${patient.gender === 'male' ? 'ذكر' : 'أنثى'} | الرقم القومي: ${patient.nid}`, 20, y + 5);
              patientCount++;
            });
          });
          
          doc.save('تقرير-المرضى.pdf');
          hideLoading();
        });
        
        showLoading();
      });
    }
    
    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });
  </script>
</body>
</html>
