<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù‚Ø³Ù… Ø§Ù„Ø£Ø´Ø¹Ø© - Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase - ØºÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const stats = { all: 0, pending: 0, done: 0 };

    function updateStats() {
      document.getElementById("all-count").textContent = stats.all;
      document.getElementById("pending-count").textContent = stats.pending;
      document.getElementById("done-count").textContent = stats.done;
    }

    function renderRow(id, data) {
      const row = document.createElement("tr");
      row.className = "border-b text-center";
      row.innerHTML = `
        <td class="p-2">${data.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</td>
        <td class="p-2">${data.nationalId || ""}</td>
        <td class="p-2">${data.radiology?.type || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"}</td>
        <td class="p-2">${data.radiology?.status || "Ø¨Ø§Ù†ØªØ¸Ø§Ø±"}</td>
        <td class="p-2">
          <textarea id="note-${id}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." class="p-1 border rounded w-full">${data.radiology?.note || ""}</textarea>
        </td>
        <td class="p-2">
          <button onclick="updateStatus('${id}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded">Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </td>
      `;
      document.getElementById("table-body").appendChild(row);

      stats.all++;
      if (data.radiology?.status === "ØªÙ…") stats.done++;
      else stats.pending++;
      updateStats();
    }

    function loadRadiologyData() {
      firebase.database().ref("patients").on("value", snapshot => {
        const tableBody = document.getElementById("table-body");
        tableBody.innerHTML = "";
        stats.all = stats.pending = stats.done = 0;

        snapshot.forEach(child => {
          const id = child.key;
          const data = child.val();
          if (data.radiology) {
            renderRow(id, data);
          }
        });
      });
    }

    function updateStatus(id) {
      const note = document.getElementById("note-" + id).value;
      firebase.database().ref('patients/' + id + '/radiology').update({
        status: "ØªÙ…",
        note: note
      }).then(() => {
        Swal.fire("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«", "ØªÙ… Ø±ÙØ¹ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø´Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­", "success");
      });
    }

    window.onload = loadRadiologyData;
  </script>
</head>
<body class="bg-gray-100 p-6">
  <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">Ù‚Ø³Ù… Ø§Ù„Ø£Ø´Ø¹Ø© - Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="grid grid-cols-3 gap-4 mb-6 text-center">
    <div class="bg-white p-4 shadow rounded">ğŸ“‹ Ø§Ù„ÙƒÙ„: <span id="all-count" class="font-bold text-lg">0</span></div>
    <div class="bg-yellow-100 p-4 shadow rounded">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø±: <span id="pending-count" class="font-bold text-lg">0</span></div>
    <div class="bg-green-100 p-4 shadow rounded">âœ… ØªÙ…: <span id="done-count" class="font-bold text-lg">0</span></div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰ -->
  <div class="overflow-auto bg-white rounded shadow">
    <table class="w-full table-auto border">
      <thead class="bg-blue-800 text-white">
        <tr>
          <th class="p-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶</th>
          <th class="p-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</th>
          <th class="p-2">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø´Ø¹Ø©</th>
          <th class="p-2">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th class="p-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th class="p-2">Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody id="table-body" class="text-sm">
        <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
      </tbody>
    </table>
  </div>
</body>
</html>
