<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-100 text-right">
  <div class="bg-white shadow p-4 flex items-center justify-between">
    <h1 class="text-2xl font-bold text-blue-800">ğŸ§‘â€âš•ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­ÙŠØ§Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h1>
    <button onclick="location.href='index.html'" class="bg-blue-600 text-white px-4 py-2 rounded">ğŸ”™ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>

  <div class="p-4">
    <input id="searchInput" type="text" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±ÙŠØ¶ Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ..." class="w-full p-2 mb-4 border rounded shadow">

    <div id="patientsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø³ÙŠÙØ¹Ø±Ø¶ÙˆÙ† Ù‡Ù†Ø§ -->
    </div>
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const patientsContainer = document.getElementById("patientsContainer");
    const searchInput = document.getElementById("searchInput");

    // ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    const loadPatients = async () => {
      patientsContainer.innerHTML = `<div class="text-center w-full col-span-3">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰...</div>`;
      const snapshot = await db.ref("patients").once("value");
      patientsContainer.innerHTML = "";

      snapshot.forEach(sectionSnap => {
        sectionSnap.forEach(patientSnap => {
          const patient = patientSnap.val();
          const id = patientSnap.key;
          const section = sectionSnap.key;

          const card = document.createElement("div");
          card.className = "bg-white p-4 rounded shadow";

          card.innerHTML = `
            <h2 class="text-xl font-bold text-blue-700 mb-2">${patient.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</h2>
            <p><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ:</strong> ${patient.nationalId || "ØºÙŠØ± Ù…Ø³Ø¬Ù„"}</p>
            <p><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${section}</p>
            <div class="mt-4 flex justify-between gap-2">
              <button onclick="viewPatient('${id}', '${section}')" class="bg-green-600 text-white px-3 py-1 rounded">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
              <button onclick="deletePatient('${id}', '${section}')" class="bg-red-600 text-white px-3 py-1 rounded">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
          `;
          patientsContainer.appendChild(card);
        });
      });
    };

    // Ø­Ø°Ù Ù…Ø±ÙŠØ¶
    function deletePatient(id, section) {
      Swal.fire({
        title: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ",
        text: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù",
        cancelButtonText: "Ø¥Ù„ØºØ§Ø¡"
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref(`patients/${section}/${id}`).remove().then(() => {
            Swal.fire("ØªÙ… Ø§Ù„Ø­Ø°Ù", "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­", "success");
            loadPatients();
          });
        }
      });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
    function viewPatient(id, section) {
      localStorage.setItem("patientId", id);
      localStorage.setItem("patientSection", section);
      window.location.href = "patient.html";
    }

    // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ø­Ø«
    searchInput.addEventListener("input", () => {
      const term = searchInput.value.toLowerCase();
      const cards = patientsContainer.querySelectorAll("div");
      cards.forEach(card => {
        const name = card.querySelector("h2")?.textContent.toLowerCase() || "";
        const nationalId = card.querySelector("p")?.textContent.toLowerCase() || "";
        card.style.display = (name.includes(term) || nationalId.includes(term)) ? "block" : "none";
      });
    });

    loadPatients();
  </script>
</body>
</html>
